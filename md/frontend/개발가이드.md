# íŠ¸ë Œë“œ ë¹„ë””ì˜¤ ìë™í™” ê°œë°œ ê°€ì´ë“œ

## ìƒí’ˆ ìë™í™” ê¸°ëŠ¥ (Product Automation)

### ê°œìš”
íŠ¸ë Œë“œ ë¹„ë””ì˜¤ ìë™í™” ì‹œìŠ¤í…œì˜ í•µì‹¬ ê¸°ëŠ¥ì¸ ìƒí’ˆ ìë™í™”ëŠ” ì¿ íŒ¡ ë² ìŠ¤íŠ¸ì…€ëŸ¬ì—ì„œ ìƒí’ˆì„ ìë™ìœ¼ë¡œ ê°€ì ¸ì™€ ì˜ìƒìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ì™„ì „ ìë™í™” ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

### 4ë‹¨ê³„ ìë™í™” í”„ë¡œì„¸ìŠ¤

#### Step 1: ì¿ íŒ¡ ë² ìŠ¤íŠ¸ì…€ëŸ¬ì—ì„œ ìƒí’ˆ ì¡°íšŒ
**ëª©ì **: ì‹¤ì‹œê°„ìœ¼ë¡œ ì¸ê¸° ìˆëŠ” ì¿ íŒ¡ ìƒí’ˆì„ ìë™ìœ¼ë¡œ ë°œê²¬

**êµ¬í˜„ ìœ„ì¹˜**: `src/app/api/automation/test-generate-stream/route.ts` (Line 223-273)

**ë™ì‘ ë°©ì‹**:
1. Coupang Affiliate APIì— ì ‘ê·¼
2. ë² ìŠ¤íŠ¸ì…€ëŸ¬ ì¹´í…Œê³ ë¦¬ 1001ë²ˆì—ì„œ ìƒìœ„ ìƒí’ˆ ì¡°íšŒ
3. HMAC-SHA256 ì„œëª…ìœ¼ë¡œ API ìš”ì²­ ì¸ì¦
4. ìƒí’ˆëª…, ê°€ê²©, ì´ë¯¸ì§€ URL ì¶”ì¶œ

**ì½”ë“œ ì˜ˆì‹œ**:
```typescript
const API_PATH = '/v2/providers/affiliate_open_api/apis/openapi/v1/products/bestcategories/1001';
const response = await fetch(`https://api-gateway.coupang.com${API_PATH}`, {
  method: 'GET',
  headers: {
    'Authorization': authorization,
    'Content-Type': 'application/json'
  }
});
```

**ì£¼ì˜ì‚¬í•­**:
- ì¿ íŒ¡ API í‚¤ëŠ” `data/coupang-settings.json`ì—ì„œ ë¡œë“œ
- ë² ìŠ¤íŠ¸ì…€ëŸ¬ëŠ” ìë™ìœ¼ë¡œ ìƒìœ„ ìƒí’ˆ 1ìˆœìœ„ ì„ íƒ
- API ì¸ì¦ ì‹¤íŒ¨ ì‹œ ì „ì²´ í”„ë¡œì„¸ìŠ¤ ì¤‘ë‹¨

---

#### Step 2: ë”¥ë§í¬(Deep Link) ìë™ ìƒì„±
**ëª©ì **: ê¸´ ì¿ íŒ¡ URLì„ ì§§ì€ ë”¥ë§í¬ë¡œ ë³€í™˜í•˜ì—¬ YouTube ì„¤ëª…ì— ì í•©í•˜ê²Œ ë§Œë“¤ê¸°

**êµ¬í˜„ ìœ„ì¹˜**: `src/app/api/automation/test-generate-stream/route.ts` (Line 289-330)

**ë™ì‘ ë°©ì‹**:
1. ë² ìŠ¤íŠ¸ì…€ëŸ¬ APIì—ì„œ ë°›ì€ ìƒí’ˆ URL ì •ê·œí™”
2. í‘œì¤€ í˜•ì‹: `https://www.coupang.com/vp/products/{productId}`ë¡œ ë³€í™˜
3. Coupang Deeplink API í˜¸ì¶œ
4. ì§§ì€ ë”¥ë§í¬ ìƒì„±: `https://link.coupang.com/a/xxxxx`

**API ì—”ë“œí¬ì¸íŠ¸**:
```
POST /v2/providers/affiliate_open_api/apis/openapi/v1/deeplink
Content-Type: application/json

{
  "coupangUrls": ["https://www.coupang.com/vp/products/123456"]
}

ì‘ë‹µ:
{
  "rCode": "0",
  "data": [
    {
      "shortenUrl": "https://link.coupang.com/a/xxxxx"
    }
  ]
}
```

**DB ì €ì¥ ë°©ì‹**:
- `video_titles.product_url` = ìƒì„±ëœ ë”¥ë§í¬ (short URL)
- `video_titles.product_data` JSONì— ì–‘ìª½ URL ëª¨ë‘ ì €ì¥:
  ```json
  {
    "deepLink": "https://link.coupang.com/a/c59d9h",
    "productUrl": "https://www.coupang.com/vp/products/...",
    "productName": "ìƒí’ˆëª…",
    "productPrice": 7500
  }
  ```

**UI í‘œì‹œ ìš°ì„ ìˆœìœ„**:
1. `product_data.deepLink` (ì§§ì€ ë§í¬) - ìµœìš°ì„ 
2. `product_data.productUrl` (ì›ë³¸ ì¿ íŒ¡ ë§í¬) - 2ìˆœìœ„
3. `product_url` ì»¬ëŸ¼ê°’ - 3ìˆœìœ„

**ì£¼ì˜ì‚¬í•­**:
- ë”¥ë§í¬ ìƒì„± ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë°œìƒ (ì›ë³¸ URL í´ë°± ì—†ìŒ)
- ëª¨ë“  ê³³ì—ì„œ ë”¥ë§í¬ë¥¼ ìš°ì„  í‘œì‹œí•´ì•¼ í•¨
- UIì—ì„œ `startEdit()` í˜¸ì¶œ ì‹œ product_dataì—ì„œ deepLink ì¶”ì¶œ

---

#### Step 3: ë‚´ ëª©ë¡(coupang_products)ì— ìë™ ì €ì¥
**ëª©ì **: ìƒì„±ëœ ìƒí’ˆì„ "ë‚´ ëª©ë¡"ì— ì €ì¥í•˜ì—¬ schedulerê°€ ê°ì§€í•  ìˆ˜ ìˆë„ë¡ ì¤€ë¹„

**êµ¬í˜„ ìœ„ì¹˜**: `src/app/api/automation/test-generate-stream/route.ts` (Line 377-413)

**ë™ì‘ ë°©ì‹**:
1. Step 2ì—ì„œ ë”¥ë§í¬ ìƒì„± ì™„ë£Œ í›„ ì‹¤í–‰
2. **ì¤‘ë³µ ì²´í¬**: ì´ë¯¸ ë‚´ ëª©ë¡ì— ìˆëŠ” ìƒí’ˆì¸ì§€ í™•ì¸ (product_urlë¡œ ë¹„êµ)
3. ì¤‘ë³µì´ë©´ ìŠ¤í‚µ, ì—†ìœ¼ë©´ `coupang_products` í…Œì´ë¸”ì— INSERT
4. ìƒí’ˆ ì •ë³´ ì €ì¥ (ID, ì´ë¦„, ë”¥ë§í¬, ê°€ê²©, ì´ë¯¸ì§€)
5. status='active'ë¡œ ì„¤ì •í•˜ì—¬ scheduler ê°ì§€ ì¤€ë¹„

**ì¤‘ë³µ ì²´í¬ ì½”ë“œ**:
```typescript
// 1. ì´ë¯¸ ë“±ë¡ëœ ìƒí’ˆì¸ì§€ í™•ì¸ (product_urlë¡œ ì¤‘ë³µ ì²´í¬)
const existingProduct = dbForInsert.prepare(`
  SELECT id FROM coupang_products
  WHERE user_id = ? AND product_url = ?
`).get(user.userId, bestProduct.productUrl) as any;

if (existingProduct) {
  sendLog(`â¸ï¸ ì´ë¯¸ ë‚´ ëª©ë¡ì— ë“±ë¡ëœ ìƒí’ˆì…ë‹ˆë‹¤ (ìŠ¤í‚µ)`);
} else {
  // 2. ìƒˆ ìƒí’ˆì¸ ê²½ìš°ì—ë§Œ ì¶”ê°€
  // INSERT ì‹¤í–‰
}
```

**ì €ì¥ë˜ëŠ” ë°ì´í„°**:
```typescript
db.prepare(`
  INSERT INTO coupang_products (
    id, user_id, product_url, deep_link, title, category,
    image_url, original_price, discount_price, status, created_at
  ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'))
`).run(
  coupangProductId,           // ìë™ ìƒì„± ID
  user.userId,                 // ì‚¬ìš©ì ID
  bestProduct.productUrl,      // Coupang ìƒí’ˆ URL (ì¤‘ë³µ ì²´í¬ìš©)
  product.deep_link,           // ìƒì„±ëœ ë”¥ë§í¬
  product.title,               // ìƒí’ˆëª…
  category,                    // ì¹´í…Œê³ ë¦¬
  product.image_url,           // ìƒí’ˆ ì´ë¯¸ì§€
  product.original_price,      // ì •ê°€
  product.discount_price,      // í• ì¸ê°€
  'active'                     // ìƒíƒœ
);
```

**í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ**:
```sql
CREATE TABLE coupang_products (
  id TEXT PRIMARY KEY,
  user_id TEXT NOT NULL,
  product_url TEXT NOT NULL,      -- ì¤‘ë³µ ì²´í¬ìš©
  deep_link TEXT NOT NULL,        -- ë”¥ë§í¬
  title TEXT NOT NULL,            -- ìƒí’ˆëª…
  category TEXT NOT NULL,         -- ì¹´í…Œê³ ë¦¬
  image_url TEXT,
  original_price REAL,
  discount_price REAL,
  status TEXT DEFAULT 'active',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);
-- ì¸ë±ìŠ¤
CREATE INDEX idx_coupang_products_user_status ON coupang_products(user_id, status);
```

**ì¤‘ë³µ ì²´í¬ íŠ¹ì§•**:
- `product_url`ë¡œ ì¤‘ë³µ ì²´í¬ (ê°™ì€ ìƒí’ˆ URLì€ í•œ ë²ˆë§Œ ì €ì¥)
- ê°™ì€ ìƒí’ˆì„ ì—¬ëŸ¬ ë²ˆ í…ŒìŠ¤íŠ¸í•´ë„ ë‚´ ëª©ë¡ì—ëŠ” í•œ ë²ˆë§Œ ì €ì¥
- UIì—ì„œëŠ” "â¸ï¸ ì´ë¯¸ ë‚´ ëª©ë¡ì— ë“±ë¡ëœ ìƒí’ˆì…ë‹ˆë‹¤ (ìŠ¤í‚µ)" ë©”ì‹œì§€ í‘œì‹œ

**ì—ëŸ¬ ì²˜ë¦¬**:
- ì €ì¥ ì‹¤íŒ¨í•´ë„ video_titles ë“±ë¡ì€ ê³„ì† ì§„í–‰
- ì‹¤íŒ¨ ë¡œê·¸ëŠ” ui ì— í‘œì‹œí•˜ë˜ í”„ë¡œì„¸ìŠ¤ ì¤‘ë‹¨ ì—†ìŒ

---

#### Step 4: Scheduler ìë™ ê°ì§€ ë° ì˜ˆì•½í ë“±ë¡
**ëª©ì **: coupang_productsì— ì €ì¥ëœ ìƒí’ˆì„ ê°ì§€í•˜ì—¬ ìë™ìœ¼ë¡œ ì˜ˆì•½í(video_schedules)ì— ë“±ë¡

**êµ¬í˜„ ìœ„ì¹˜**: `src/lib/automation-scheduler.ts` (Line 1720-1824)

**í•¨ìˆ˜ëª…**: `checkAndRegisterCoupangProducts()`

**ë™ì‘ ë°©ì‹**:
1. **ê°ì§€**: coupang_products í…Œì´ë¸”ì—ì„œ status='active'ì´ê³  ì•„ì§ ìŠ¤ì¼€ì¤„ì´ ì—†ëŠ” ìƒí’ˆ ì¡°íšŒ
2. **ì œëª© ìƒì„±**: ê° ìƒí’ˆë§ˆë‹¤ video_titles í…Œì´ë¸”ì— ìƒˆë¡œìš´ í•­ëª© ìƒì„±
3. **ì±„ë„ ë°°ì •**: ì‚¬ìš©ìì˜ í™œì„±í™”ëœ ì²« ë²ˆì§¸ ì±„ë„ ìë™ ë°°ì •
4. **ìŠ¤ì¼€ì¤„ ê³„ì‚°**: calculateNextScheduleTime() í•¨ìˆ˜ë¡œ ë‹¤ìŒ ì—…ë¡œë“œ ì‹œê°„ ê³„ì‚°
5. **í ë“±ë¡**: video_schedules í…Œì´ë¸”ì— status='pending'ìœ¼ë¡œ ë“±ë¡
6. **ìë™ ì‹¤í–‰**: Scheduler ì£¼ê¸° ì²´í¬(3ì´ˆ ê°„ê²©)ì—ì„œ ìë™ ê°ì§€

**í˜¸ì¶œ ìœ„ì¹˜**:
```typescript
// src/lib/automation-scheduler.ts

// 1. Scheduler ì‹œì‘ ì‹œ ì¦‰ì‹œ ì‹¤í–‰ (Line 95)
checkAndRegisterCoupangProducts();

// 2. ì£¼ê¸°ì  ì²´í¬ ë£¨í”„ì—ì„œ ê³„ì† ì‹¤í–‰ (Line 114)
schedulerInterval = setInterval(() => {
  processPendingSchedules();
  checkWaitingForUploadSchedules();
  checkReadyToUploadSchedules();
  checkCompletedShortformJobs();
  checkAndRegisterCoupangProducts();  // â† Step 4 ì‹¤í–‰
  // ... ë‚˜ë¨¸ì§€ ì²´í¬
}, checkInterval);
```

**êµ¬í˜„ ì½”ë“œ**:
```typescript
export async function checkAndRegisterCoupangProducts() {
  try {
    const db = new Database(dbPath);

    // 1. ê°ì§€: ìŠ¤ì¼€ì¤„ì´ ì—†ëŠ” í™œì„± ìƒí’ˆ ì¡°íšŒ
    const newProducts = db.prepare(`
      SELECT cp.*
      FROM coupang_products cp
      WHERE cp.status = 'active'
        AND NOT EXISTS (
          SELECT 1 FROM video_schedules vs
          WHERE vs.product_url LIKE '%' || SUBSTR(cp.deep_link, -6) || '%'
        )
      ORDER BY cp.created_at DESC
      LIMIT 10
    `).all() as any[];

    if (newProducts.length === 0) {
      console.log('[Step 4] No new products detected for scheduling');
      return { success: 0, failed: 0, skipped: 0 };
    }

    console.log(`[Step 4] Detected ${newProducts.length} new products`);

    let successCount = 0;
    let failedCount = 0;

    for (const product of newProducts) {
      try {
        // 2. video_titles í•­ëª© ìƒì„±
        const titleId = `title_${Date.now()}_${Math.random().toString(36).substring(2, 15)}`;
        const productData = JSON.stringify({
          productId: product.product_id,
          productName: product.product_name,
          productPrice: product.discount_price || product.original_price,
          productImage: product.image_url,
          deepLink: product.deep_link
        });

        // 3. ì±„ë„ ìë™ ë°°ì •
        const channelSetting = db.prepare(`
          SELECT channel_id, channel_name FROM youtube_channel_settings
          WHERE user_id = ? AND is_active = 1
          LIMIT 1
        `).get(product.user_id) as any;

        if (!channelSetting) {
          console.log(`[Step 4] No active channel for user, skipping`);
          continue;
        }

        // video_titlesì— ì €ì¥
        db.prepare(`
          INSERT INTO video_titles (
            id, user_id, title, category, type, status,
            channel, product_url, product_data, created_at
          ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'))
        `).run(
          titleId, product.user_id, product.product_name,
          product.category_id || 'ìƒí’ˆ', 'product', 'pending',
          channelSetting.channel_id, product.deep_link, productData
        );

        // 4. ìŠ¤ì¼€ì¤„ ê³„ì‚° ë° 5. í ë“±ë¡
        const scheduleId = `schedule_${Date.now()}_${Math.random().toString(36).substring(2, 15)}`;
        const { calculateNextScheduleTime } = await import('./automation');
        const scheduledTime = calculateNextScheduleTime(product.user_id, channelSetting.channel_id) || new Date();

        db.prepare(`
          INSERT INTO video_schedules (
            id, title_id, scheduled_time, status, channel_setting_id, created_at
          ) VALUES (?, ?, ?, ?, ?, datetime('now'))
        `).run(
          scheduleId, titleId, scheduledTime.toISOString(),
          'pending', channelSetting.channel_id
        );

        console.log(`[Step 4] âœ… Product registered: ${product.product_name}`);
        successCount++;

      } catch (error: any) {
        console.error(`[Step 4] âŒ Failed: ${error.message}`);
        failedCount++;
      }
    }

    db.close();
    return { success: successCount, failed: failedCount, skipped: 0 };

  } catch (error: any) {
    console.error('[Step 4] Error:', error.message);
    return { success: 0, failed: 0, skipped: 0 };
  }
}
```

**ì£¼ì˜ì‚¬í•­**:
- coupang_productsì˜ statusê°€ 'active'ì¸ ìƒí’ˆë§Œ ì²˜ë¦¬
- ì´ë¯¸ video_schedulesì— ë“±ë¡ëœ ìƒí’ˆì€ ì œì™¸
- ì±„ë„ì´ ì—†ìœ¼ë©´ ìŠ¤í‚µ (ì‚¬ìš©ìê°€ ì±„ë„ì„ í™œì„±í™”í•´ì•¼ í•¨)
- ìµœëŒ€ 10ê°œê¹Œì§€ë§Œ í•œ ë²ˆì— ì²˜ë¦¬ (DB ë¶€í•˜ ë°©ì§€)
- ì—ëŸ¬ ë°œìƒ ì‹œ ë‚˜ë¨¸ì§€ ìƒí’ˆì€ ê³„ì† ì²˜ë¦¬

---

### ì „ì²´ íë¦„ë„

```
í…ŒìŠ¤íŠ¸ ë²„íŠ¼ í´ë¦­
    â†“
Step 1: ë² ìŠ¤íŠ¸ì…€ëŸ¬ API í˜¸ì¶œ â†’ ìƒí’ˆ ì •ë³´ ì¡°íšŒ
    â†“
Step 2: ë”¥ë§í¬ API í˜¸ì¶œ â†’ ì§§ì€ URL ìƒì„±
    â†“
Step 3: coupang_products í…Œì´ë¸”ì— ì €ì¥ â†’ status='active'
    â†“
video_titles ì €ì¥ (product_url = deeplink)
    â†“
Scheduler ê°ì§€ (3ì´ˆ ì£¼ê¸°)
    â†“
Step 4: checkAndRegisterCoupangProducts() ì‹¤í–‰
    â†“
video_schedulesì— ìë™ ë“±ë¡ â†’ status='pending'
    â†“
Schedulerê°€ pending ìŠ¤ì¼€ì¤„ ê°ì§€
    â†“
ëŒ€ë³¸ ìƒì„± â†’ ì˜ìƒ ìƒì„± â†’ YouTube ì—…ë¡œë“œ
```

---

### í•µì‹¬ íŒŒì¼ ë° ì½”ë“œ ìœ„ì¹˜

| íŒŒì¼ | ì—­í•  | Line |
|------|------|------|
| `src/app/api/automation/test-generate-stream/route.ts` | Step 1-3 êµ¬í˜„ | 223-402 |
| `src/lib/automation.ts` | coupang_products í…Œì´ë¸” ìƒì„± | 380-403 |
| `src/lib/automation-scheduler.ts` | Step 4 scheduler êµ¬í˜„ | 1720-1824 |
| `src/app/automation/page.tsx` | UIì—ì„œ deeplink í‘œì‹œ | 2740, 2790, 3432 |
| `ê¸°ëŠ¥ëª©ë¡.md` | ê¸°ëŠ¥ ëª…ì„¸ì„œ | - |

---

### í…ŒìŠ¤íŠ¸ ë°©ë²•

#### ìˆ˜ë™ í…ŒìŠ¤íŠ¸
1. ìë™í™” í˜ì´ì§€ â†’ "í…ŒìŠ¤íŠ¸" ë²„íŠ¼ í´ë¦­
2. ì‹¤ì‹œê°„ ë¡œê·¸ í™•ì¸:
   - âœ… "ì¿ íŒ¡ ë² ìŠ¤íŠ¸ì…€ëŸ¬ì—ì„œ ìƒí’ˆ ë°œê²¬"
   - âœ… "ë”¥ë§í¬ ìƒì„± ì™„ë£Œ"
   - âœ… "ë‚´ ëª©ë¡ ë“±ë¡ ì™„ë£Œ"
   - âœ… "ìƒí’ˆ ë“±ë¡ ì™„ë£Œ"
3. ìë™í™” í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
4. ì œëª© ëª©ë¡ì—ì„œ ìƒˆ ìƒí’ˆ í™•ì¸
5. "ìˆ˜ì •" ë²„íŠ¼ í´ë¦­ â†’ "URL (ë”¥ë§í¬)" í™•ì¸

#### ìƒí’ˆ í™•ì¸
- `coupang_products` í…Œì´ë¸”ì—ì„œ status='active' ë ˆì½”ë“œ í™•ì¸
- `video_titles` í…Œì´ë¸”ì—ì„œ type='product' ë ˆì½”ë“œ í™•ì¸
- `video_schedules` í…Œì´ë¸”ì—ì„œ status='pending' ë ˆì½”ë“œ í™•ì¸

---

### ìì£¼ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜ ë° í•´ê²°ì±…

#### 1. "ë”¥ë§í¬ ìƒì„± ì‹¤íŒ¨: url convert failed"
**ì›ì¸**: API ê²½ë¡œ ë˜ëŠ” URL í˜•ì‹ì´ ì˜ëª»ë¨

**í•´ê²°ì±…**:
- API ê²½ë¡œ: `/v2/providers/affiliate_open_api/apis/openapi/v1/deeplink` (v1 í•„ìˆ˜)
- URL í˜•ì‹: `https://www.coupang.com/vp/products/{productId}`ë¡œ ì •ê·œí™”
- ë¹ˆ ë¬¸ìì—´ì´ ì•„ë‹Œì§€ í™•ì¸

```typescript
const standardProductUrl = `https://www.coupang.com/vp/products/${productIdToUse}`;
```

#### 2. "ì¿ íŒ¡ API ì˜¤ë¥˜: 401"
**ì›ì¸**: ì¸ì¦ ì‹¤íŒ¨ (API í‚¤ ë˜ëŠ” ì„œëª… ì˜¤ë¥˜)

**í•´ê²°ì±…**:
- `data/coupang-settings.json` íŒŒì¼ í™•ì¸
- accessKey, secretKey ì •í™•ì„± í™•ì¸
- ì‹œê°„ ë™ê¸°í™” í™•ì¸ (HMAC ì„œëª…ì— í˜„ì¬ ì‹œê°„ ì‚¬ìš©)

#### 3. "No active channel found"
**ì›ì¸**: ì‚¬ìš©ìì˜ í™œì„±í™”ëœ YouTube ì±„ë„ì´ ì—†ìŒ

**í•´ê²°ì±…**:
- ì„¤ì • â†’ YouTube ì±„ë„ â†’ "í™œì„±í™”" í™•ì¸
- youtube_channel_settings í…Œì´ë¸”ì—ì„œ is_active=1 í™•ì¸

#### 4. ë”¥ë§í¬ê°€ UIì— ì•ˆ ë³´ì„
**ì›ì¸**: product_data JSON íŒŒì‹± ì‹¤íŒ¨ ë˜ëŠ” deepLink í•„ë“œ ì—†ìŒ

**í•´ê²°ì±…**:
- `startEdit()` í•¨ìˆ˜ì—ì„œ product_data JSON íŒŒì‹± í™•ì¸
- DBì— ì €ì¥ëœ product_data í™•ì¸
- í´ë°±: productUrl â†’ product_url ìˆœì„œ í™•ì¸

---

### ì„±ëŠ¥ ìµœì í™”

#### ëŒ€ëŸ‰ ìƒí’ˆ ì²˜ë¦¬
- `checkAndRegisterCoupangProducts()`ì—ì„œ í•œ ë²ˆì— ìµœëŒ€ 10ê°œ ì²˜ë¦¬
- í•„ìš”ì‹œ LIMIT ê°’ ì¡°ì • ê°€ëŠ¥

#### ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤
```sql
-- coupang_products ì¡°íšŒ ì„±ëŠ¥
CREATE INDEX idx_coupang_products_user_status ON coupang_products(user_id, status);
```

#### API í˜¸ì¶œ ìµœì í™”
- ë² ìŠ¤íŠ¸ì…€ëŸ¬ëŠ” ìƒìœ„ 1ê°œë§Œ ì„ íƒ (API í˜¸ì¶œ 1íšŒ)
- ë”¥ë§í¬ëŠ” ë°°ì¹˜ ì²˜ë¦¬ ê°€ëŠ¥ (ìµœëŒ€ 10ê°œ/ìš”ì²­)

---

### ì²´í¬ë¦¬ìŠ¤íŠ¸

ìƒí’ˆ ìë™í™” ê¸°ëŠ¥ì„ êµ¬í˜„í•  ë•Œ í™•ì¸í•´ì•¼ í•  ì‚¬í•­:

- [ ] Step 1: Coupang ë² ìŠ¤íŠ¸ì…€ëŸ¬ API í˜¸ì¶œ ì„±ê³µ
- [ ] Step 2: ë”¥ë§í¬ API í˜¸ì¶œ ì„±ê³µ ë° URL ìƒì„± í™•ì¸
- [ ] Step 3: coupang_products í…Œì´ë¸”ì— ìƒí’ˆ ì €ì¥ í™•ì¸
- [ ] Step 4: video_titlesì— type='product' ë ˆì½”ë“œ ìƒì„± í™•ì¸
- [ ] Step 5: video_schedulesì— status='pending' ë ˆì½”ë“œ ìƒì„± í™•ì¸
- [ ] UI: deeplinkê°€ ëª¨ë“  ê³³ì— í‘œì‹œë˜ëŠ”ì§€ í™•ì¸
- [ ] Scheduler: 3ì´ˆ ì£¼ê¸°ë¡œ checkAndRegisterCoupangProducts() ì‹¤í–‰ í™•ì¸
- [ ] ì—ëŸ¬ ì²˜ë¦¬: ì‹¤íŒ¨í•´ë„ ë‹¤ìŒ ìƒí’ˆ ê³„ì† ì²˜ë¦¬í•˜ëŠ”ì§€ í™•ì¸
- [ ] ë¡œê¹…: ê° ë‹¨ê³„ë³„ ë¡œê·¸ê°€ ì •í™•íˆ ë‚¨ëŠ”ì§€ í™•ì¸

---

## BTS (Bug Tracking System) ì‘ì—… í”„ë¡œì„¸ìŠ¤

### ì¤‘ìš”: ì‘ì—… ìˆœì„œ

ë²„ê·¸ ìˆ˜ì • ì‹œ **ë°˜ë“œì‹œ ë‹¤ìŒ ìˆœì„œ**ë¥¼ ë”°ë¼ì•¼ í•©ë‹ˆë‹¤:

#### 1ë‹¨ê³„: BTS í™•ì¸ ë° ë“±ë¡
**ë¨¼ì € `md/bts.md` íŒŒì¼ì„ í™•ì¸í•˜ì—¬ ë™ì¼í•œ ë²„ê·¸ê°€ ì´ë¯¸ ë“±ë¡ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.**

```bash
# BTS íŒŒì¼ì—ì„œ í‚¤ì›Œë“œ ê²€ìƒ‰
grep -i "image.*log" md/bts.md
grep -i "youtube.*token" md/bts.md
```

**ê²½ìš° 1: ì´ë¯¸ ë“±ë¡ëœ ë²„ê·¸ì¸ ê²½ìš°**
- ê¸°ì¡´ BTS ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤ (ì˜ˆ: BTS-0000028)
- í•´ë‹¹ BTSì˜ "ìƒíƒœ"ë¥¼ í™•ì¸í•©ë‹ˆë‹¤:
  - `ğŸ”´ ë°œìƒ` â†’ ì‘ì—… ì§„í–‰
  - `âœ… í•´ê²°ë¨` â†’ ì¬ë°œ ë²„ê·¸ì´ë¯€ë¡œ ìƒíƒœë¥¼ ë‹¤ì‹œ `ğŸ”´ ë°œìƒ`ìœ¼ë¡œ ë³€ê²½

**ê²½ìš° 2: ìƒˆë¡œìš´ ë²„ê·¸ì¸ ê²½ìš°**
- ìƒˆë¡œìš´ BTS ë²ˆí˜¸ë¥¼ í• ë‹¹í•©ë‹ˆë‹¤ (ê°€ì¥ ìµœê·¼ ë²ˆí˜¸ + 1)
- BTS í…œí”Œë¦¿ì— ë”°ë¼ ë“±ë¡í•©ë‹ˆë‹¤

#### 2ë‹¨ê³„: ì½”ë“œ ìˆ˜ì •
ë“±ë¡ëœ BTS ë²ˆí˜¸ë¥¼ ì°¸ì¡°í•˜ì—¬ ì½”ë“œë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤.

```javascript
// âœ… ì˜¬ë°”ë¥¸ ì£¼ì„ ë°©ì‹
// âœ… BTS-0000028: image.log íŒŒì¼ì— ë¡œê·¸ ì €ì¥
appendToLogFile(taskId, 'image', text.trim());
```

#### 3ë‹¨ê³„: ì»¤ë°‹ ë©”ì‹œì§€
BTS ë²ˆí˜¸ë¥¼ ì»¤ë°‹ ë©”ì‹œì§€ì— ë°˜ë“œì‹œ í¬í•¨í•©ë‹ˆë‹¤.

```bash
git commit -m "fix: BTS-0000028 - Image ë‹¨ê³„ image.log íŒŒì¼ ì €ì¥ ì¶”ê°€"
```

#### 4ë‹¨ê³„: BTS ìƒíƒœ ì—…ë°ì´íŠ¸
ì½”ë“œ ìˆ˜ì • ë° ì»¤ë°‹ì´ ì™„ë£Œë˜ë©´ BTS íŒŒì¼ì˜ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.

```markdown
**ìƒíƒœ:** âœ… **í•´ê²°ë¨**
```

### BTS ë“±ë¡ í…œí”Œë¦¿

```markdown
## ğŸ”´ BTS-XXXXXXX: [ê°„ë‹¨í•œ ë²„ê·¸ ì„¤ëª…]

**ë°œìƒì¼:** YYYY-MM-DD

**ìƒíƒœ:** ğŸ”´ **ë°œìƒ**

**ì‹¬ê°ë„:**
- ğŸ”´ **CRITICAL** - ì‹œìŠ¤í…œ ì¤‘ë‹¨, ë°ì´í„° ì†ì‹¤
- ğŸŸ¡ **MEDIUM** - ê¸°ëŠ¥ ì¥ì• , ë””ë²„ê¹… ë¶ˆí¸
- ğŸŸ¢ **LOW** - UI ê°œì„ , ì„±ëŠ¥ ìµœì í™”

**ì¦ìƒ:**
- [ì‚¬ìš©ìê°€ ê²ªëŠ” ë¬¸ì œ ì„¤ëª…]
- [ì—ëŸ¬ ë©”ì‹œì§€ ë˜ëŠ” ë¡œê·¸]

**ê·¼ë³¸ ì›ì¸:**
- [ê¸°ìˆ ì  ì›ì¸ ë¶„ì„]
- [ì™œ ì´ ë²„ê·¸ê°€ ë°œìƒí–ˆëŠ”ì§€]

**ìˆ˜ì • ë°©ë²•:**
`íŒŒì¼ëª…:ë¼ì¸ë²ˆí˜¸` - ìˆ˜ì • ë‚´ìš©

\`\`\`javascript
// âŒ ì˜ëª»ëœ ì½”ë“œ
const result = wrongFunction();

// âœ… ì˜¬ë°”ë¥¸ ì½”ë“œ
const result = correctFunction();
\`\`\`

**ì¬ë°œ ë°©ì§€:**
- [ì•ìœ¼ë¡œ ì´ëŸ° ë²„ê·¸ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•œ ë°©ë²•]

**ê´€ë ¨ íŒŒì¼:**
- `src/path/to/file.js:123-456`
```

### ì‘ì—… ì‹œ ì£¼ì˜ì‚¬í•­

1. **ì ˆëŒ€ BTS ë“±ë¡ì„ ê±´ë„ˆë›°ì§€ ë§ˆì„¸ìš”**
   - ì‘ì€ ë²„ê·¸ë„ ë°˜ë“œì‹œ BTSì— ë“±ë¡
   - ì¶”í›„ ë¹„ìŠ·í•œ ë²„ê·¸ ë°œìƒ ì‹œ ì°¸ê³  ìë£Œê°€ ë¨

2. **BTS ë²ˆí˜¸ëŠ” ìˆœì°¨ì ìœ¼ë¡œ ì¦ê°€**
   - ë§ˆì§€ë§‰ BTS ë²ˆí˜¸ í™•ì¸ í›„ +1
   - ì¤‘ë³µ ë²ˆí˜¸ ì ˆëŒ€ ì‚¬ìš© ê¸ˆì§€

3. **ìƒíƒœ ë³€ê²½ì€ ì •í™•í•˜ê²Œ**
   - ì½”ë“œ ìˆ˜ì •ë§Œ í–ˆë‹¤ê³  `âœ… í•´ê²°ë¨`ì´ ì•„ë‹˜
   - ì‹¤ì œ í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„ ë³€ê²½

4. **ì¬ë°œ ë²„ê·¸ ì²˜ë¦¬**
   - ê°™ì€ BTS ë²ˆí˜¸ ì‚¬ìš©
   - ì¬ë°œ ì›ì¸ ì¶”ê°€ ë¶„ì„
   - "ì¬ë°œ ë°©ì§€" ì„¹ì…˜ ê°•í™”

### ì˜ˆì‹œ: ì „ì²´ ì‘ì—… íë¦„

```bash
# 1. BTS í™•ì¸
grep -i "image log" md/bts.md
# â†’ BTS-0000028 ë°œê²¬: Image ë¡œê·¸ íŒŒì¼ ë¯¸ìƒì„±

# 2. ìƒíƒœ í™•ì¸
# ìƒíƒœ: âœ… í•´ê²°ë¨ â†’ ì¬ë°œ ë²„ê·¸!

# 3. ìƒíƒœë¥¼ "ë°œìƒ"ìœ¼ë¡œ ë³€ê²½
# ìƒíƒœ: ğŸ”´ ë°œìƒ

# 4. ì½”ë“œ ìˆ˜ì •
# unified-worker.jsì— appendToLogFile ì¶”ê°€

# 5. ì»¤ë°‹
git add src/workers/unified-worker.js
git commit -m "fix: BTS-0000028 - Image ë‹¨ê³„ ë¡œê·¸ íŒŒì¼ ì €ì¥ ì¬ìˆ˜ì •"

# 6. í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„ ìƒíƒœ ì—…ë°ì´íŠ¸
# ìƒíƒœ: âœ… í•´ê²°ë¨
```

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025ë…„ 12ì›” 3ì¼
**ìƒíƒœ**: âœ… ì™„ì „ êµ¬í˜„ (Step 1 ~ 4 ëª¨ë‘ ì™„ë£Œ)
