# BTS-0000030: YouTube 업로드 실패 시 에러 로그 불충분

**발생일:** 2025-12-03

**상태:** ✅ **해결됨**

**심각도:** 🟡 **MEDIUM** - 디버깅 불편, 에러 원인 파악 어려움

**증상:**
- "이미 처리 중이거나 완료된 작업입니다" 에러만 표시
- 실제 task_queue 상태를 알 수 없음
- Python 실패 시 stderr만 표시, 파일 경로/메타데이터 정보 없음
- 토큰/비디오 파일 찾기 실패 시 원인 파악 불가

**근본 원인:**
- DB 락 획득 실패 시 현재 상태 조회 안함
- Python 프로세스 실패 시 최소한의 에러 정보만 출력
- 파일 찾기 실패 시 폴더 내 실제 파일 목록 미출력

**수정 내역:**

1. **DB 락 획득 실패 - 상태 조회 추가** (`unified-worker.js:588-606`)
```javascript
if (lockResult.affectedRows === 0) {
  const currentTask = await getOne(`
    SELECT task_id, type, status, created_at, updated_at
    FROM task_queue WHERE task_id = ? AND type = 'youtube'
  `, [taskId]);

  console.error(`❌ 락 획득 실패: status=${currentTask.status}`);
  // DB + 로그 파일에 기록
}
```

2. **Python 실패 - 자세한 정보 출력** (`unified-worker.js:886-905`)
```javascript
console.error(`❌ Python 프로세스 실패 (exit code: ${code})`);
console.error(`📁 Video: ${videoPath}`);
console.error(`📁 Token: ${tokenPath}`);
console.error(`📋 Metadata:`, JSON.stringify(metadata, null, 2));
console.error(`🔴 Python stderr:\n${errorOutput}`);
// DB + youtube.log에 모두 기록
```

3. **토큰 찾기 실패 - 사용 가능한 토큰 목록** (`unified-worker.js:795-803`)
```javascript
const allTokenFiles = configFiles.filter(f => f.startsWith('youtube_token_'));
console.error(`❌ YouTube 토큰 없음`);
console.error(`📊 User ID: ${content.user_id}`);
console.error(`📁 사용 가능한 토큰 (${allTokenFiles.length}개):`, allTokenFiles.join(', '));
```

4. **비디오 파일 찾기 실패 - 폴더 내 파일 목록** (`unified-worker.js:665-675`)
```javascript
const allFiles = fs.readdirSync(taskFolder);
const mp4Files = allFiles.filter(f => f.endsWith('.mp4'));
console.error(`❌ 영상 파일 없음`);
console.error(`📁 폴더 내 모든 파일:`, allFiles.join(', '));
console.error(`📁 MP4 파일:`, mp4Files.join(', '));
```

**효과:**
- 에러 발생 시 즉시 원인 파악 가능
- DB + 로그 파일에 자세한 디버깅 정보 기록
- 파일/토큰 문제 발생 시 실제 상황 확인 가능

**관련 파일:**
- `src/workers/unified-worker.js:588-606, 665-675, 795-803, 886-905`

---
