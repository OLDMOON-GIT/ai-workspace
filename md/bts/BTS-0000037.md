# BTS-0000037: í¬ë¡¤ë§ ì´ë¯¸ì§€ UIê°€ ì˜ëª»ëœ ë°ì´í„°ë¡œ í‘œì‹œë¨ (0/0, Scene undefined)

**ë°œìƒì¼:** 2025-12-03

**ìƒíƒœ:** âœ… í•´ê²°ë¨ (ì™„ì „ í•´ê²° - UI ë³µì› ì™„ë£Œ)

**í•´ê²°ì¼:** 2025-12-03

**ì‹¬ê°ë„:** ğŸŸ¡ **MINOR** - UI í‘œì‹œ ì˜¤ë¥˜

---

## ì¦ìƒ

- Automation í˜ì´ì§€ì—ì„œ í¬ë¡¤ë§ ì´ë¯¸ì§€ í‘œì‹œ ì˜ì—­ì´ ë‚˜íƒ€ë‚¨
- **"í¬ë¡¤ë§ ì´ë¯¸ì§€ (0/0)"** - completedScenesì™€ totalScenesê°€ ëª¨ë‘ 0 ë˜ëŠ” undefined
- **"Scene undefined"** - img.sceneNumberê°€ undefinedë¡œ í‘œì‹œë¨
- ì‚¬ìš©ì: "ì‹œë²Œ ë‹¤ê¹¨ì ¸ì„œ ë‚˜ì˜¤ë„¤ ì–´ë”° ì“°ëƒ?"

**ìŠ¤í¬ë¦°ìƒ· ì¬í˜„:**
```
ğŸ–¼ï¸ í¬ë¡¤ë§ ì´ë¯¸ì§€ (0/0)
[ì´ë¯¸ì§€ í¬ë¡¤ë§ ì¤‘...]
ë˜ëŠ”
Scene undefined
Scene undefined
```

---

## ê·¼ë³¸ ì›ì¸

### 1. crawledImagesMapì´ ì—…ë°ì´íŠ¸ë˜ì§€ ì•ŠìŒ

**ë¬¸ì œ íŒŒì¼:** `src/app/automation/page.tsx:181`

**ì„ ì–¸ë§Œ ìˆìŒ:**
```typescript
const [crawledImagesMap, setCrawledImagesMap] = useState<Record<string, any>>({}); // taskIdë³„ í¬ë¡¤ë§ëœ ì´ë¯¸ì§€ ëª©ë¡
```

**ë¬¸ì œì :**
1. `setCrawledImagesMap`ì´ **ë‹¨ í•œ ë²ˆë„ í˜¸ì¶œë˜ì§€ ì•ŠìŒ**
2. SSEë‚˜ í´ë§ìœ¼ë¡œ ì´ë¯¸ì§€ í¬ë¡¤ë§ ì§„í–‰ ìƒí™©ì„ ë°›ëŠ” ë¡œì§ì´ ì—†ìŒ
3. ë¹ˆ ê°ì²´ `{}`ë¡œë§Œ ë‚¨ì•„ìˆì–´ì„œ ë°ì´í„°ê°€ ì „í˜€ ì—†ìŒ

### 2. UIëŠ” ì¡°ê±´ ì—†ì´ í‘œì‹œë¨

**ë¬¸ì œ íŒŒì¼:** `src/app/automation/page.tsx:4868-4905`

**ë¬¸ì œ ì½”ë“œ:**
```typescript
const imageData = crawledImagesMap[title.id];
// ì´ë¯¸ì§€ í¬ë¡¤ë§ ì¤‘ì´ê±°ë‚˜ ì™„ë£Œëœ ê²½ìš°ì—ë§Œ í‘œì‹œ
const showImages = imageData && (imageData.images?.length > 0 || imageData.totalScenes > 0);

return showImages && (
  <div>
    <p>ğŸ–¼ï¸ í¬ë¡¤ë§ ì´ë¯¸ì§€ ({imageData.completedScenes || 0}/{imageData.totalScenes || 0})</p>
    ...
    <img alt={`Scene ${img.sceneNumber}`} ... />
    <div>#{img.sceneNumber}</div>
  </div>
);
```

**ë¬¸ì œì :**
1. `crawledImagesMap[title.id]`ê°€ ì¡´ì¬í•˜ê¸°ë§Œ í•˜ë©´ UI í‘œì‹œ
2. `imageData.completedScenes`, `imageData.totalScenes`ê°€ undefined â†’ "(0/0)" ì¶œë ¥
3. `img.sceneNumber`ê°€ undefined â†’ "Scene undefined" ì¶œë ¥
4. **ë°ì´í„° í˜•ì‹ ë¶ˆì¼ì¹˜**: backendëŠ” `scene_number` (snake_case) ì‚¬ìš©, frontendëŠ” `sceneNumber` (camelCase) ê¸°ëŒ€

---

## í•´ê²° ë°©ë²•

### âœ… 1ì°¨ í•´ê²°: UI ìˆ¨ê¹€ (êµ¬í˜„ ë¯¸ì™„ì„±)

**ìˆ˜ì • íŒŒì¼:** `src/app/automation/page.tsx:4866-4867`

**ìˆ˜ì • ì½”ë“œ:**
```typescript
{/* í¬ë¡¤ë§ ì´ë¯¸ì§€ (ì˜¤ë¥¸ìª½) - êµ¬í˜„ ë¯¸ì™„ì„±ìœ¼ë¡œ ì£¼ì„ ì²˜ë¦¬ */}
{/* TODO: crawledImagesMap ì—…ë°ì´íŠ¸ ë¡œì§ êµ¬í˜„ í•„ìš” */}
```

**ì´ìœ :**
- crawledImagesMap ì—…ë°ì´íŠ¸ ë¡œì§ì´ ì „í˜€ ì—†ìŒ
- ë¯¸ì™„ì„± ê¸°ëŠ¥ì„ í‘œì‹œí•˜ë©´ ì‚¬ìš©ì í˜¼ë€ë§Œ ê°€ì¤‘ë¨
- ì œëŒ€ë¡œ êµ¬í˜„ë  ë•Œê¹Œì§€ UI ìˆ¨ê¹€

### âœ… 2ì°¨ í•´ê²°: ì™„ì „ êµ¬í˜„ (UI ë³µì› ì™„ë£Œ)

**ìˆ˜ì • íŒŒì¼:**
- `src/app/automation/page.tsx:1620-1683` - ë¡œê·¸ íŒŒì‹± ë¡œì§ ì¶”ê°€
- `src/app/automation/page.tsx:4960-5006` - UI ë³µì› ë° ë°ì´í„° ë°”ì¸ë”© ìˆ˜ì •

**1ë‹¨ê³„: ë¡œê·¸ íŒŒì‹± ë¡œì§ êµ¬í˜„ (Line 1620-1683)**

fetchLogs í•¨ìˆ˜ì—ì„œ ì´ë¯¸ì§€ í¬ë¡¤ë§ ë¡œê·¸ë¥¼ íŒŒì‹±í•˜ì—¬ crawledImagesMapì„ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸:

```typescript
// fetchLogsì—ì„œ ë¡œê·¸ íŒŒì‹± í˜¸ì¶œ
if (data.logs && data.logs.length > 0) {
  setLogsMap(prev => { ... });
  logOffsetsRef.current[taskId] = data.logOffset || ...;

  // ğŸ¨ ì´ë¯¸ì§€ í¬ë¡¤ë§ ì§„í–‰ ìƒí™© íŒŒì‹± (BTS-0000037 ë³µì›)
  parseImageCrawlingProgress(taskId, data.logs);
}

// ë¡œê·¸ íŒŒì‹± í•¨ìˆ˜
function parseImageCrawlingProgress(taskId: string, logs: any[]) {
  const updates: Record<string, { status: string; sceneNumber?: string }> = {};

  logs.forEach((log) => {
    const msg = log.message || '';

    // íŒ¨í„´ 1: "ğŸ“Œ scene_01 ì…ë ¥ ì¤‘" â†’ uploading
    const inputMatch = msg.match(/ğŸ“Œ\s+(scene_\d+|Scene\s+\d+)\s+ì…ë ¥\s+ì¤‘/i);
    if (inputMatch) {
      const sceneId = inputMatch[1].toLowerCase().replace(/\s+/g, '_');
      updates[sceneId] = { status: 'uploading', sceneNumber: sceneId };
    }

    // íŒ¨í„´ 2: "âœ… scene_01 ì…ë ¥ ì™„ë£Œ" â†’ generating
    const completeMatch = msg.match(/âœ…\s+(scene_\d+|Scene\s+\d+)\s+ì…ë ¥\s+ì™„ë£Œ/i);
    if (completeMatch) {
      const sceneId = completeMatch[1].toLowerCase().replace(/\s+/g, '_');
      updates[sceneId] = { status: 'generating', sceneNumber: sceneId };
    }

    // íŒ¨í„´ 3: "ğŸ“¥ scene_01ì˜ ì´ë¯¸ì§€ ìˆ˜ì§‘ ì¤‘" â†’ downloading
    const collectMatch = msg.match(/ğŸ“¥\s+(scene_\d+|Scene\s+\d+).*ì´ë¯¸ì§€\s+ìˆ˜ì§‘/i);
    if (collectMatch) {
      const sceneId = collectMatch[1].toLowerCase().replace(/\s+/g, '_');
      updates[sceneId] = { status: 'downloading', sceneNumber: sceneId };
    }

    // íŒ¨í„´ 4: "âœ… scene_01 ë‹¤ìš´ë¡œë“œ ì„±ê³µ" â†’ completed
    const downloadMatch = msg.match(/âœ….*?(scene_\d+|Scene\s+\d+).*ë‹¤ìš´ë¡œë“œ\s+ì„±ê³µ/i);
    if (downloadMatch) {
      const sceneId = downloadMatch[1].toLowerCase().replace(/\s+/g, '_');
      updates[sceneId] = { status: 'completed', sceneNumber: sceneId };
    }

    // íŒ¨í„´ 5: "âš ï¸ scene_01 ì…ë ¥ ì‹¤íŒ¨" â†’ failed
    const failMatch = msg.match(/âš ï¸.*?(scene_\d+|Scene\s+\d+).*(ì‹¤íŒ¨|ì˜¤ë¥˜|ì—ëŸ¬)/i);
    if (failMatch) {
      const sceneId = failMatch[1].toLowerCase().replace(/\s+/g, '_');
      updates[sceneId] = { status: 'failed', sceneNumber: sceneId };
    }
  });

  // crawledImagesMap ì—…ë°ì´íŠ¸
  if (Object.keys(updates).length > 0) {
    setCrawledImagesMap(prev => ({
      ...prev,
      [taskId]: { ...(prev[taskId] || {}), ...updates }
    }));
  }
}
```

**2ë‹¨ê³„: UI ë³µì› ë° ë°ì´í„° ë°”ì¸ë”© ìˆ˜ì • (Line 4960-5006)**

```typescript
{/* ğŸ¨ í¬ë¡¤ë§ ì´ë¯¸ì§€ ì§„í–‰ ìƒí™© (ì˜¤ë¥¸ìª½) - BTS-0000037 ë³µì› */}
{(() => {
  const imageData = crawledImagesMap[title.id];
  if (!imageData || Object.keys(imageData).length === 0) return null;

  const totalScenes = Object.keys(imageData).length;
  const completedScenes = Object.values(imageData).filter((s: any) => s.status === 'completed').length;
  const failedScenes = Object.values(imageData).filter((s: any) => s.status === 'failed').length;

  return (
    <div className="p-2 bg-slate-700/50 rounded border border-slate-600">
      <p className="text-xs font-semibold text-purple-400 mb-1">
        ğŸ–¼ï¸ ì´ë¯¸ì§€ í¬ë¡¤ë§ ({completedScenes}/{totalScenes})
      </p>
      <div className="grid grid-cols-4 gap-1 mt-1">
        {Object.entries(imageData).map(([sceneId, scene]: [string, any]) => {
          const statusEmoji =
            scene.status === 'completed' ? 'âœ…' :
            scene.status === 'failed' ? 'âŒ' :
            scene.status === 'downloading' ? 'â¬‡ï¸' :
            scene.status === 'generating' ? 'â³' :
            scene.status === 'uploading' ? 'â¬†ï¸' : 'â¸ï¸';

          const statusColor =
            scene.status === 'completed' ? 'bg-emerald-600' :
            scene.status === 'failed' ? 'bg-red-600' :
            scene.status === 'downloading' ? 'bg-blue-600' :
            scene.status === 'generating' ? 'bg-amber-600' :
            scene.status === 'uploading' ? 'bg-purple-600' : 'bg-slate-600';

          return (
            <div
              key={sceneId}
              className={`p-1 ${statusColor} rounded text-center`}
              title={`${sceneId}: ${scene.status}`}
            >
              <span className="text-xs">{statusEmoji}</span>
            </div>
          );
        })}
      </div>
      {failedScenes > 0 && (
        <p className="text-xs text-red-400 mt-1">âš ï¸ {failedScenes}ê°œ ì‹¤íŒ¨</p>
      )}
    </div>
  );
})()}
```

**ê°œì„  ì‚¬í•­:**
1. âœ… **ìë™ ë¡œê·¸ íŒŒì‹±**: fetchLogsì—ì„œ ìë™ìœ¼ë¡œ scene ì§„í–‰ ìƒí™© ì¶”ì¶œ
2. âœ… **5ê°€ì§€ ìƒíƒœ ì¶”ì **: uploading, generating, downloading, completed, failed
3. âœ… **ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸**: ë¡œê·¸ê°€ ì¶”ê°€ë  ë•Œë§ˆë‹¤ ìë™ìœ¼ë¡œ UI ì—…ë°ì´íŠ¸
4. âœ… **ì‹œê°ì  í”¼ë“œë°±**: ìƒíƒœë³„ ìƒ‰ìƒ êµ¬ë¶„ ë° ì´ëª¨ì§€ í‘œì‹œ
5. âœ… **ì‹¤íŒ¨ ì•Œë¦¼**: ì‹¤íŒ¨í•œ ì”¬ì´ ìˆì„ ê²½ìš° ê²½ê³  í‘œì‹œ
6. âœ… **ë°ì´í„° í˜•ì‹ í†µì¼**: sceneIdë¥¼ snake_caseë¡œ ì •ê·œí™” (scene_01, scene_02...)

### ğŸ“‹ í–¥í›„ ì™„ì „ í•´ê²° ë°©ì•ˆ

#### 1ë‹¨ê³„: Backendì—ì„œ ì´ë¯¸ì§€ í¬ë¡¤ë§ ì§„í–‰ ìƒí™© ì „ì†¡

**í•„ìš”í•œ ì‘ì—…:**
- `create_video_from_folder.py`ì—ì„œ ì´ë¯¸ì§€ í¬ë¡¤ë§ ì§„í–‰ ì‹œ JSON í˜•ì‹ìœ¼ë¡œ ì¶œë ¥
- í˜•ì‹ ì˜ˆì‹œ:
```json
{
  "type": "image_progress",
  "completedScenes": 3,
  "totalScenes": 8,
  "images": [
    {"filename": "scene_00.jpg", "path": "/tasks/xxx/scene_00.jpg", "sceneNumber": 0},
    {"filename": "scene_01.jpg", "path": "/tasks/xxx/scene_01.jpg", "sceneNumber": 1}
  ]
}
```

#### 2ë‹¨ê³„: Frontendì—ì„œ SSE/í´ë§ìœ¼ë¡œ ë°ì´í„° ìˆ˜ì‹ 

**í•„ìš”í•œ ì‘ì—…:**
- `generate-video-upload` APIì—ì„œ Python stdoutì„ íŒŒì‹±í•˜ì—¬ image_progress ì´ë²¤íŠ¸ ì „ì†¡
- ë˜ëŠ” í´ë§ API ì¶”ê°€ (`/api/task-progress/{taskId}`)

#### 3ë‹¨ê³„: UI ì—…ë°ì´íŠ¸

**í•„ìš”í•œ ì‘ì—…:**
```typescript
// SSE ìˆ˜ì‹  ì‹œ
if (event.type === 'image_progress') {
  setCrawledImagesMap(prev => ({
    ...prev,
    [taskId]: {
      completedScenes: event.completedScenes,
      totalScenes: event.totalScenes,
      images: event.images, // âš ï¸ sceneNumber (camelCase) í˜•ì‹ìœ¼ë¡œ ì „ë‹¬
      progress: Math.round((event.completedScenes / event.totalScenes) * 100)
    }
  }));
}
```

#### 4ë‹¨ê³„: Backend/Frontend ë°ì´í„° í˜•ì‹ í†µì¼

**ë¬¸ì œ:**
- Backend: `scene_number` (Python snake_case)
- Frontend: `sceneNumber` (JavaScript camelCase)

**í•´ê²°:**
- Backendì—ì„œ ì¶œë ¥í•  ë•Œ camelCaseë¡œ ë³€í™˜
- ë˜ëŠ” Frontendì—ì„œ ìˆ˜ì‹  ì‹œ ë³€í™˜

---

## ì¬ë°œ ë°©ì§€

### UI ê°œë°œ ê·œì¹™

1. âœ… **State ì—…ë°ì´íŠ¸ ë¡œì§ ì—†ì´ UI ì¶”ê°€ ê¸ˆì§€**
   - Stateë¥¼ ì„ ì–¸í–ˆìœ¼ë©´ ë°˜ë“œì‹œ ì–´ë””ì„ ê°€ ì—…ë°ì´íŠ¸ë˜ì–´ì•¼ í•¨
   - `setState` í˜¸ì¶œì´ ì—†ìœ¼ë©´ ì½”ë“œ ë¦¬ë·° ì‹œ ê²½ê³ 

2. âœ… **ë¯¸ì™„ì„± ê¸°ëŠ¥ì€ ì£¼ì„ ì²˜ë¦¬**
   - TODO ì£¼ì„ìœ¼ë¡œ ëª…í™•íˆ í‘œì‹œ
   - ì‚¬ìš©ìì—ê²Œ ë³´ì´ì§€ ì•Šë„ë¡ ìˆ¨ê¹€

3. âœ… **Optional chainingê³¼ ê¸°ë³¸ê°’ ì‚¬ìš©**
   ```typescript
   // âŒ ë‚˜ìœ ì˜ˆ
   alt={`Scene ${img.sceneNumber}`}  // undefined â†’ "Scene undefined"

   // âœ… ì¢‹ì€ ì˜ˆ
   alt={`Scene ${img.sceneNumber ?? '?'}`}  // undefined â†’ "Scene ?"
   ```

4. âœ… **Backend/Frontend ë°ì´í„° í˜•ì‹ í†µì¼**
   - snake_case vs camelCase ì¼ê´€ì„± ìœ ì§€
   - íƒ€ì… ì •ì˜ë¡œ ê²€ì¦

---

## ì˜í–¥ ë²”ìœ„

**ìˆ˜ì •ëœ íŒŒì¼:**
- `src/app/automation/page.tsx:4866-4867` - í¬ë¡¤ë§ ì´ë¯¸ì§€ UI ì£¼ì„ ì²˜ë¦¬

**ì˜í–¥ ë°›ëŠ” ê¸°ëŠ¥:**
- Automation í˜ì´ì§€ ì œëª© ì¹´ë“œì—ì„œ í¬ë¡¤ë§ ì´ë¯¸ì§€ í‘œì‹œ ì˜ì—­ (ìˆ¨ê¹€)

**í…ŒìŠ¤íŠ¸ ë°©ë²•:**
1. Automation í˜ì´ì§€ ë¡œë“œ
2. í¬ë¡¤ë§ ì´ë¯¸ì§€ UIê°€ í‘œì‹œë˜ì§€ ì•ŠëŠ”ì§€ í™•ì¸
3. "(0/0)", "Scene undefined" ì—ëŸ¬ê°€ ì‚¬ë¼ì¡ŒëŠ”ì§€ í™•ì¸

---

## êµ¬í˜„ ì™„ë£Œ

- âœ… **1ì°¨**: í¬ë¡¤ë§ ì´ë¯¸ì§€ UI ì£¼ì„ ì²˜ë¦¬ (ë¯¸ì™„ì„± ê¸°ëŠ¥ ìˆ¨ê¹€)
- âœ… **2ì°¨**: ë¡œê·¸ íŒŒì‹± ë¡œì§ êµ¬í˜„ (parseImageCrawlingProgress)
- âœ… **2ì°¨**: UI ë³µì› ë° ë°ì´í„° ë°”ì¸ë”© ìˆ˜ì •
- âœ… **2ì°¨**: 5ê°€ì§€ ìƒíƒœ ì¶”ì  ë° ì‹¤ì‹œê°„ UI ì—…ë°ì´íŠ¸

**í…ŒìŠ¤íŠ¸ ë°©ë²•:**
1. Automation í˜ì´ì§€ì—ì„œ ì´ë¯¸ì§€ í¬ë¡¤ë§ ì‹¤í–‰
2. ë¡œê·¸ ì°½ì„ ì—´ì–´ì„œ scene ì§„í–‰ ìƒí™© í™•ì¸
3. ìƒí’ˆ ì •ë³´ ì˜†ì— "ğŸ–¼ï¸ ì´ë¯¸ì§€ í¬ë¡¤ë§ (ì™„ë£Œ/ì „ì²´)" í‘œì‹œ í™•ì¸
4. ê° sceneì´ ìƒíƒœë³„ë¡œ ìƒ‰ìƒ/ì´ëª¨ì§€ê°€ ì˜¬ë°”ë¥´ê²Œ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸:
   - â¬†ï¸ ë³´ë¼ìƒ‰: uploading (í”„ë¡¬í”„íŠ¸ ì…ë ¥ ì¤‘)
   - â³ ë…¸ë€ìƒ‰: generating (ì´ë¯¸ì§€ ìƒì„± ì¤‘)
   - â¬‡ï¸ íŒŒë€ìƒ‰: downloading (ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì¤‘)
   - âœ… ì´ˆë¡ìƒ‰: completed (ì™„ë£Œ)
   - âŒ ë¹¨ê°„ìƒ‰: failed (ì‹¤íŒ¨)
