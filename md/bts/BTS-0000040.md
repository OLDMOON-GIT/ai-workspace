# BTS-0000040: ìƒí’ˆ YouTube ì„¤ëª…/ëŒ“ê¸€ ì—¬ì „íˆ ì—…ë¡œë“œ ì•ˆ ë¨ (BTS-0000039 ì¬ë°œ)

**ë°œìƒì¼:** 2025-12-03

**ìƒíƒœ:** ğŸ”„ **ì¡°ì‚¬ ì¤‘** - ë””ë²„ê·¸ ë¡œê·¸ ì¶”ê°€ ë° í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„±

**ì‹¬ê°ë„:** ğŸ”´ **CRITICAL** - ìƒí’ˆ YouTube ì„¤ëª… ëˆ„ë½ìœ¼ë¡œ ìˆ˜ìµí™” ë¶ˆê°€

---

## ì¦ìƒ

**ì‚¬ìš©ì í”¼ë“œë°±:**
> "ì•„ì§ ìƒí’ˆ...ëŒ“ê¸€, ì„¤ëª… ì•ˆì˜¬ë¼ê°€ë„¤ ì•„ ì‹œë°œ ì§„ì§œ ê°œìƒˆë¼ ã… ã… ã…  ë§¨ë‚  ë»¥ë§Œì¹˜ê³ "

**ë¬¸ì œ:**
- BTS-0000039ì—ì„œ `promptFormat === 'product'` ì²´í¬ë¡œ ìˆ˜ì •í–ˆìœ¼ë‚˜ ì—¬ì „íˆ ì‘ë™ ì•ˆ í•¨
- ìƒí’ˆ ëŒ€ë³¸ ìƒì„± í›„ YouTube ì—…ë¡œë“œ ì‹œ `story.json`ì˜ `youtube_description`ì´ ì‚¬ìš©ë˜ì§€ ì•ŠìŒ
- ê¸°ë³¸ ì„¤ëª…ë§Œ ì—…ë¡œë“œë¨

---

## ê·¼ë³¸ ì›ì¸ (ì¡°ì‚¬ ì¤‘)

### ê°€ëŠ¥ì„± 1: Content í…Œì´ë¸”ì— prompt_format í•„ë“œê°€ ì—†ìŒ
- `unified-worker.js Line 701`ì—ì„œ `content.promptFormat` ë˜ëŠ” `content.prompt_format`ì„ ì²´í¬í•˜ëŠ”ë°
- ì‹¤ì œ DB í…Œì´ë¸”ì— í•´ë‹¹ í•„ë“œê°€ ì—†ì„ ê°€ëŠ¥ì„±

### ê°€ëŠ¥ì„± 2: í•„ë“œëª… ë¶ˆì¼ì¹˜
- Content í…Œì´ë¸”: `prompt_format` (snake_case)
- Content_setting í…Œì´ë¸”: `promptFormat` (camelCase)
- LEFT JOINìœ¼ë¡œ ì¡°íšŒí•˜ëŠ”ë° í•„ë“œê°€ ë®ì–´ì¨ì§ˆ ê°€ëŠ¥ì„±

### ê°€ëŠ¥ì„± 3: í•„ë“œ ê°’ì´ ë‹¤ë¥¸ í˜•ì‹
- DBì—ëŠ” ë‹¤ë¥¸ ê°’ìœ¼ë¡œ ì €ì¥ë˜ì–´ ìˆì„ ê°€ëŠ¥ì„±
- ì˜ˆ: `category` í•„ë“œì— "ìƒí’ˆ"ìœ¼ë¡œ ì €ì¥, `prompt_format` í•„ë“œëŠ” NULL

---

## ì„ì‹œ í•´ê²° ë°©ë²•

### 1. ë””ë²„ê·¸ ë¡œê·¸ ì¶”ê°€ (unified-worker.js)

**ì¶”ê°€í•œ ë¡œê·¸ (Line 646-651):**
```javascript
// ğŸ” DEBUG: content í•„ë“œ í™•ì¸
console.log(`${emoji} [${type}] ğŸ” Content í•„ë“œ í™•ì¸:`);
console.log(`${emoji} [${type}]   - promptFormat: ${content.promptFormat}`);
console.log(`${emoji} [${type}]   - prompt_format: ${content.prompt_format}`);
console.log(`${emoji} [${type}]   - category: ${content.category}`);
console.log(`${emoji} [${type}]   - title: ${content.title}`);
```

**ì¶”ê°€í•œ ë¡œê·¸ (Line 709-747):**
```javascript
// ìƒí’ˆ ì²´í¬ ë¡œì§
console.log(`${emoji} [${type}] ğŸ” ìƒí’ˆ ì²´í¬: promptFormat=${content.promptFormat}, prompt_format=${content.prompt_format}`);

if (content.promptFormat === 'product' || content.prompt_format === 'product') {
  console.log(`${emoji} [${type}] âœ… ìƒí’ˆìœ¼ë¡œ ê°ì§€ë¨ - story.jsonì—ì„œ youtube_description ë¡œë“œ ì‹œë„`);
  console.log(`${emoji} [${type}] ğŸ“ Story path: ${storyPath}`);
  console.log(`${emoji} [${type}] ğŸ“ Story exists: ${fs.existsSync(storyPath)}`);

  // story.json íŒŒì‹±
  console.log(`${emoji} [${type}] ğŸ“Š Story data keys:`, Object.keys(storyData));
  console.log(`${emoji} [${type}] ğŸ“Š Has youtube_description:`, !!storyData.youtube_description);

  if (storyData.youtube_description && storyData.youtube_description.text) {
    console.log(`${emoji} [${type}] ğŸ“¦ ìƒí’ˆ YouTube ì„¤ëª… ë¡œë“œ ì„±ê³µ (${description.length}ì)`);
    console.log(`${emoji} [${type}] ğŸ“¦ ì„¤ëª… ë¯¸ë¦¬ë³´ê¸°: ${description.substring(0, 100)}...`);
  } else {
    console.warn(`${emoji} [${type}] âš ï¸ story.jsonì— youtube_description.text ì—†ìŒ`);
  }
} else {
  console.log(`${emoji} [${type}] â­ï¸ ìƒí’ˆ ì•„ë‹˜ - youtube_description ë¡œë“œ ê±´ë„ˆëœ€`);
}
```

**ëª©ì :**
- ì‹¤ì œë¡œ `content.promptFormat`ê³¼ `content.prompt_format`ì— ì–´ë–¤ ê°’ì´ ìˆëŠ”ì§€ í™•ì¸
- ìƒí’ˆ ì²´í¬ ë¡œì§ì´ ì‹¤í–‰ë˜ëŠ”ì§€ í™•ì¸
- story.json íŒŒì¼ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
- youtube_descriptionì´ ì œëŒ€ë¡œ ë¡œë“œë˜ëŠ”ì§€ í™•ì¸

---

## í•´ê²° ë°©ë²•

### âœ… í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„±

**íŒŒì¼:** `test-product-youtube-integration.mjs`

**í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤:**
1. âœ… ìƒí’ˆ ì œëª© ë“±ë¡ (`promptFormat: 'product'`)
2. âœ… `story.json` ìƒì„± (AI ëŒ€ë³¸ ìƒì„± ì‹œë®¬ë ˆì´ì…˜)
3. âœ… YouTube ì—…ë¡œë“œ ë¡œì§ ê²€ì¦
   - Content ì¡°íšŒ ì‹œ `promptFormat`/`prompt_format` í•„ë“œ í™•ì¸
   - ìƒí’ˆ ì²´í¬ ë¡œì§ ì‹¤í–‰ í™•ì¸
   - `story.json`ì—ì„œ `youtube_description` ë¡œë“œ í™•ì¸
   - `description`ê³¼ `pinnedComment` ì„¤ì • í™•ì¸
4. âœ… ìˆí¼ â†’ ë¡±í¼ ë§í¬ ë¡œì§ ê²€ì¦
   - `source_content_id`ë¡œ ë¡±í¼ URL ì¡°íšŒ í™•ì¸
   - ì„¤ëª…ê³¼ ê³ ì • ëŒ“ê¸€ì— ë¡±í¼ ë§í¬ ì¶”ê°€ í™•ì¸
5. âœ… í…ŒìŠ¤íŠ¸ ë°ì´í„° ì •ë¦¬

**ì‹¤í–‰ ë°©ë²•:**
```bash
node test-product-youtube-integration.mjs
```

**ê¸°ëŒ€ ê²°ê³¼:**
- ëª¨ë“  assertion í†µê³¼
- ìƒí’ˆ ì²´í¬ ë¡œì§ì´ ì œëŒ€ë¡œ ì‹¤í–‰ë¨ì„ í™•ì¸
- YouTube ì„¤ëª…/ëŒ“ê¸€ì´ ì œëŒ€ë¡œ ì„¤ì •ë¨ì„ í™•ì¸

---

## ë‹¤ìŒ ë‹¨ê³„

### 1. ì‹¤ì œ ìƒí’ˆ ëŒ€ë³¸ ìƒì„± í›„ ë¡œê·¸ í™•ì¸

**ì‹¤í–‰:**
1. ìƒí’ˆ ëŒ€ë³¸ ìƒì„± (promptFormat: 'product')
2. YouTube ì—…ë¡œë“œ ì‹¤í–‰
3. Worker ë¡œê·¸ì—ì„œ ë‹¤ìŒ í™•ì¸:
   ```
   ğŸ” Content í•„ë“œ í™•ì¸:
     - promptFormat: ???
     - prompt_format: ???
     - category: ???

   ğŸ” ìƒí’ˆ ì²´í¬: promptFormat=???, prompt_format=???

   âœ… ìƒí’ˆìœ¼ë¡œ ê°ì§€ë¨ (ë˜ëŠ” â­ï¸ ìƒí’ˆ ì•„ë‹˜)
   ```

### 2. Content í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ í™•ì¸

**í™•ì¸ í•­ëª©:**
- `prompt_format` ì»¬ëŸ¼ ì¡´ì¬ ì—¬ë¶€
- `promptFormat` ì»¬ëŸ¼ ì¡´ì¬ ì—¬ë¶€ (camelCase)
- ì‹¤ì œ ì €ì¥ëœ ê°’ í™•ì¸

**SQL:**
```sql
-- í…Œì´ë¸” êµ¬ì¡° í™•ì¸
DESCRIBE content;

-- ìƒí’ˆ ë°ì´í„° í™•ì¸
SELECT content_id, title, category, prompt_format, promptFormat
FROM content
WHERE category = 'ìƒí’ˆ' OR title LIKE '%ìƒí’ˆ%'
LIMIT 5;
```

### 3. Content ìƒì„± ë¡œì§ í™•ì¸

**í™•ì¸í•  íŒŒì¼:**
- `src/app/api/automation/schedules/route.ts` - ìŠ¤ì¼€ì¤„ì—ì„œ content ìƒì„±
- `src/app/api/generate-video-upload/route.ts` - ëŒ€ë³¸ ìƒì„± ì‹œ content ìƒì„±
- DB INSERT êµ¬ë¬¸ì—ì„œ `prompt_format` í•„ë“œê°€ í¬í•¨ë˜ëŠ”ì§€ í™•ì¸

### 4. ìˆ˜ì • ë°©í–¥

**Option A: prompt_format í•„ë“œê°€ ì—†ëŠ” ê²½ìš°**
```javascript
// category í•„ë“œë¡œ ì²´í¬ (ë‹¨, ì˜ë¬¸ê°’ìœ¼ë¡œ ë³€ê²½ í•„ìš”)
if (content.category === 'product') {
  // ìƒí’ˆ ë¡œì§
}
```

**Option B: í•„ë“œëª… ë¶ˆì¼ì¹˜ í•´ê²°**
```javascript
// DB ìŠ¤í‚¤ë§ˆ í™•ì¸ í›„ ì •í™•í•œ í•„ë“œëª… ì‚¬ìš©
if (content.prompt_format === 'product') {
  // ìƒí’ˆ ë¡œì§
}
```

**Option C: Content ìƒì„± ì‹œ prompt_format ì¶”ê°€**
```sql
INSERT INTO content (..., prompt_format, ...)
VALUES (..., 'product', ...)
```

---

## ì˜í–¥ ë²”ìœ„

**ìˆ˜ì •ëœ íŒŒì¼:**
- `src/workers/unified-worker.js:646-651` - Content í•„ë“œ ë””ë²„ê·¸ ë¡œê·¸
- `src/workers/unified-worker.js:709-747` - ìƒí’ˆ ì²´í¬ ë””ë²„ê·¸ ë¡œê·¸
- `test-product-youtube-integration.mjs` - í†µí•© í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸

**ì˜í–¥ ë°›ëŠ” ê¸°ëŠ¥:**
- ìƒí’ˆ ëŒ€ë³¸ YouTube ì—…ë¡œë“œ (description, pinned comment)

---

## ì¬ë°œ ë°©ì§€

### ì½”ë“œ ë¦¬ë·° ì²´í¬ë¦¬ìŠ¤íŠ¸

1. âœ… **DB ìŠ¤í‚¤ë§ˆ í™•ì¸ ë¨¼ì €**
   - ì½”ë“œ ìˆ˜ì • ì „ì— ì‹¤ì œ í…Œì´ë¸” êµ¬ì¡° í™•ì¸
   - í•„ë“œëª…, ë°ì´í„° íƒ€ì…, ì‹¤ì œ ê°’ í™•ì¸

2. âœ… **í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„±**
   - ì „ì²´ í”Œë¡œìš°ë¥¼ í…ŒìŠ¤íŠ¸í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±
   - DB â†’ íŒŒì¼ ìƒì„± â†’ ë¡œì§ ì‹¤í–‰ â†’ ê²°ê³¼ ê²€ì¦

3. âœ… **ë””ë²„ê·¸ ë¡œê·¸ ì¶”ê°€**
   - ì˜ì‹¬ë˜ëŠ” ë¶€ë¶„ì— ìƒì„¸í•œ ë¡œê·¸ ì¶”ê°€
   - ì‹¤ì œ ê°’ì„ ì¶œë ¥í•´ì„œ í™•ì¸

4. âœ… **ë‹¨ê³„ë³„ ê²€ì¦**
   - í•œ ë²ˆì— ì „ì²´ë¥¼ ìˆ˜ì •í•˜ì§€ ë§ê³ 
   - ë‹¨ê³„ë³„ë¡œ ìˆ˜ì •í•˜ê³  ê²€ì¦

---

## ê´€ë ¨ ì´ìŠˆ

- **BTS-0000039**: ìƒí’ˆ/ìˆí¼ YouTube ì—…ë¡œë“œ ë¡œì§ ë¯¸ì‘ë™ (promptFormat ì²´í¬ë¡œ ìˆ˜ì •í–ˆìœ¼ë‚˜ ì¬ë°œ)
- **BTS-0000024**: ì›ë˜ ì´ ì´ìŠˆì—ì„œ ìƒí’ˆ/ìˆí¼ ê¸°ëŠ¥ êµ¬í˜„ë¨

---

## êµ¬í˜„ ì§„í–‰ ìƒí™©

- âœ… ë””ë²„ê·¸ ë¡œê·¸ ì¶”ê°€ (unified-worker.js)
- âœ… í†µí•© í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±
- ğŸ”„ ì‹¤ì œ ìƒí’ˆ ëŒ€ë³¸ ìƒì„± í›„ ë¡œê·¸ í™•ì¸ í•„ìš”
- ğŸ”„ Content í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ í™•ì¸ í•„ìš”
- ğŸ”„ ê·¼ë³¸ ì›ì¸ íŒŒì•… í›„ ìˆ˜ì • í•„ìš”
