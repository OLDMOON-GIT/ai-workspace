# BTS-0000018: video ë‹¨ê³„ì—ì„œ ë˜ completed ì„¤ì •ë¨

**ë°œìƒì¼:** 2025-12-02

**ìƒíƒœ:** âœ… **í•´ê²°ë¨**

**ì‹¬ê°ë„:** ğŸ”´ **CRITICAL** - video ì™„ë£Œ ì‹œ completedë¡œ ì„¤ì •ë˜ëŠ” ë¬¸ì œ ì¬ë°œ

**ì¦ìƒ:**
- video ë‹¨ê³„ ì™„ë£Œ ì‹œ `content.status = 'completed'` ì„¤ì •ë¨
- ì˜¬ë°”ë¥¸ ë™ì‘: `content.status = 'video', task_queue: type='youtube', status='waiting'`
- BTS-0000012ì™€ ë‹¤ë¥¸ ì›ì¸ (BTS-0000012ëŠ” unified-worker ë²„ê·¸, ì´ê±´ API ë²„ê·¸)

**ê·œì¹™ (ì¬í™•ì¸):**
```
âœ… video ì™„ë£Œ â†’ content.status = 'video', task_queue: type='youtube', status='waiting'
âŒ video ì™„ë£Œ â†’ content.status = 'completed' (ì ˆëŒ€ ì•ˆë¨!)

completedëŠ” youtube ë‹¨ê³„ì—ì„œë§Œ!
```

**ê·¼ë³¸ ì›ì¸:**
`generate-video-upload/route.ts`ê°€ ì˜ìƒ ìƒì„± ì™„ë£Œ ì‹œ `updateJob(status: 'completed')` í˜¸ì¶œ

**ë¬¸ì œ ì½”ë“œ:**
```javascript
// âŒ generate-video-upload/route.ts:854-860
await updateJob(taskId, {
  status: 'completed',  // âš ï¸ video ì™„ë£Œ ì‹œ completedë¡œ ì„¤ì •!
  progress: 100,
  step: 'ì™„ë£Œ!',
  videoPath,
  thumbnailPath
});
```

**ì‹¤í–‰ íë¦„:**
```
1. unified-worker: processTask(video) â†’ API í˜¸ì¶œ
2. API: generateVideoFromUpload ì‹¤í–‰
3. generateVideoFromUpload: updateJob(status: 'completed') â†’ content.status = 'completed'
4. API ë¦¬í„´
5. unified-worker: triggerNextStage('video') í˜¸ì¶œ
6. triggerNextStage: content.status = 'video'ë¡œ UPDATE (ë®ì–´ì”€)
7. triggerNextStage: task_queue â†’ type='youtube', status='waiting'

ë¬¸ì œ: 3ë²ˆì—ì„œ ì ì‹œ completedê°€ ì„¤ì •ë¨ (5-6ë²ˆì—ì„œ videoë¡œ ìˆ˜ì •ë˜ê¸´ í•¨)
```

**ìˆ˜ì • ë‚´ì—­:**

**generate-video-upload/route.ts:855-861** - status ì œê±°:
```javascript
// âœ… BTS-0000018: statusëŠ” unified-workerê°€ ê´€ë¦¬í•¨
// ì—¬ê¸°ì„œëŠ” videoPath/thumbnailPathë§Œ ì—…ë°ì´íŠ¸
await updateJob(taskId, {
  progress: 100,
  step: 'ì˜ìƒ ìƒì„± ì™„ë£Œ',
  videoPath,
  thumbnailPath
  // status ì œê±°: unified-workerì˜ triggerNextStageê°€ 'video'ë¡œ ì„¤ì •
});
```

**ì±…ì„ ë¶„ë¦¬:**
- `generateVideoFromUpload`: ì˜ìƒ ìƒì„± + videoPath/thumbnailPath ì—…ë°ì´íŠ¸ë§Œ
- `unified-worker`: ëª¨ë“  ìƒíƒœ ê´€ë¦¬ (content.status, task_queue)

**ê²°ê³¼:**
- video ì™„ë£Œ ì‹œ: unified-workerê°€ content.status = 'video' ì„¤ì •
- youtube ì™„ë£Œ ì‹œ: unified-workerê°€ content.status = 'completed' ì„¤ì •
- ì¤‘ê°„ì— completedê°€ ì„¤ì •ë˜ëŠ” ì¼ ì—†ìŒ

---
