# BTS-0000041: 제목 추가 시 잘못된 탭 포커싱

## 📋 기본 정보
- **발생일**: 2025-12-03
- **우선순위**: 🟡 **MINOR**
- **상태**: ✅ **해결됨**
- **관련 파일**: `src/app/automation/page.tsx:1295-1309`

## 🐛 증상

제목 추가 시 탭 포커싱이 잘못됨:
- **일반 제목 추가** (롱폼, 숏폼 등): 예약 탭으로 가야 하는데 대본 탭으로 이동
- **예약 실행**: 예약 탭으로 가야 하는데 대본 탭으로 이동

올바른 동작:
- **일반 제목 추가**: 예약 탭 포커싱 (나중에 스케줄 추가)
- **예약 실행**: 예약 탭 포커싱 (미래 시간)
- **즉시 실행** (상품 자동 실행만): 대본 탭 포커싱

## 🔍 근본 원인

`addTitle` 함수에서 즉시 실행 판단 로직이 잘못됨:

```typescript
// ❌ 잘못된 로직
const isImmediateExecution = !newTitle.scheduleTime ||
  (newTitle.scheduleTime && new Date(newTitle.scheduleTime).getTime() - Date.now() < 60000);

if (isImmediateExecution) {
  setQueueTab('script'); // 스케줄이 없으면 무조건 대본 탭으로 이동
}
```

문제점:
- `!newTitle.scheduleTime`이면 무조건 즉시 실행으로 판단
- 일반 제목 추가 시 스케줄 시간이 없는 것이 정상인데, 이 경우도 대본 탭으로 이동됨

## ✅ 해결 방법

즉시 실행은 **상품 타입이고 스케줄 시간이 없는 경우만** 해당:

```typescript
// ✅ 올바른 로직
const isImmediateExecution = !newTitle.scheduleTime &&
  (newTitle.promptFormat === 'product' || newTitle.promptFormat === 'product-info');

if (isImmediateExecution) {
  // 즉시 실행 (상품 자동 실행): 진행 큐 → 대본 탭으로 자동 전환
  setQueueTab('script');
} else {
  // 일반 제목 추가 또는 예약 실행: 예약 큐 탭으로 자동 전환
  setQueueTab('schedule');
}
```

### 수정 위치
`src/app/automation/page.tsx:1297-1309`

## 📊 테스트 시나리오

### 1. 일반 제목 추가 (롱폼)
- 스케줄 시간 없음
- **기대**: 예약 탭 포커싱 ✅
- **결과**: 예약 탭으로 이동 ✅

### 2. 예약 실행 (미래 시간)
- 스케줄 시간 있음 (예: 내일 오후 2시)
- **기대**: 예약 탭 포커싱 ✅
- **결과**: 예약 탭으로 이동 ✅

### 3. 상품 즉시 실행
- 상품 타입, 스케줄 시간 없음
- **기대**: 대본 탭 포커싱 ✅
- **결과**: 대본 탭으로 이동 ✅

## 🔐 재발 방지

1. **명확한 즉시 실행 기준**:
   - 상품 타입이고 스케줄 시간이 없는 경우만 즉시 실행
   - 그 외에는 모두 예약 탭 포커싱

2. **코드 주석 추가**:
   - 즉시 실행 판단 로직에 명확한 주석 추가

## 📝 커밋 메시지
```
fix: BTS-0000041 - 제목 추가 시 잘못된 탭 포커싱 수정

- 일반 제목 추가 시 예약 탭으로 포커싱
- 상품 즉시 실행만 대본 탭으로 포커싱
- 즉시 실행 판단 로직 명확화
```
