# BTS-0000006: 제목 수정 폼 채널 표시 오류

**발생일:** 2025-12-02

**상태:** ✅ 해결됨

**증상:**
- 리스트 화면: 채널이 "📺 6090놀이터"로 올바르게 표시됨
- 수정 폼: 채널이 "쇼츠왕"으로 잘못 표시됨

**원인:**
1. **SQL alias 문제** (이미 수정됨):
   - `sql/automation.sql` (line 241): `youtube_channel as channel` → `youtube_channel as youtubeChannel`
   - `sql/scheduler.sql` (line 57, 268): 동일한 문제

2. **채널 찾기 로직 문제** (startEdit 함수):
   - 잘못: `channels.find(ch => ch.channel_id === actualChannelId)` (snake_case)
   - 올바름: `channels.find(c => c.id === actualChannelId || c.channelId === actualChannelId)` (camelCase)
   - channels 배열의 실제 속성은 `id` 또는 `channelId`인데 `channel_id`로 찾고 있었음

3. **기본값 문제**:
   - 매칭 실패 시 `channels[0]` (쇼츠왕)을 기본값으로 사용
   - 매칭 실패 시 빈 문자열로 유지해야 함

**해결 방법:**

`src/app/automation/page.tsx` (line 1352-1359) 수정:
```typescript
// Before:
const matchedChannel = channels.find((c: any) =>
  c.id === actualChannelId || c.channelId === actualChannelId
);
const finalChannelId = matchedChannel?.id || matchedChannel?.channelId || '';
//                                      ^^^ 내부 UUID가 먼저 선택됨!

// After:
const matchedChannel = channels.find((c: any) =>
  c.id === actualChannelId || c.channelId === actualChannelId
);
const finalChannelId = matchedChannel?.channelId || matchedChannel?.id || '';
//                                      ^^^^^^^^^ 실제 YouTube 채널 ID가 먼저 선택됨!
```

**근본 원인:**
- YouTubeChannel 객체에는 두 개의 ID가 있음:
  - `id`: 내부 UUID (예: abc-123-def-456)
  - `channelId`: 실제 YouTube 채널 ID (예: UCxxx...)
- DB `youtube_channel` 컬럼에는 `channelId` 값이 저장됨
- 하지만 `finalChannelId`를 설정할 때 `matchedChannel.id`를 먼저 사용해서 UUID가 선택됨
- 채널 select 드롭다운은 `channelId`를 value로 사용하므로 UUID와 매칭되지 않음
- 결과적으로 첫 번째 채널("쇼츠왕")이 선택됨

**재발 방지:**
1. **사용자에게 "콘솔 확인", "새로고침" 등 시키지 말 것**
   - 리스트 화면 코드를 먼저 읽고 분석
   - 관련 코드를 모두 찾아서 직접 비교

2. **객체 속성명 주의**:
   - API 응답/DB 쿼리: snake_case → camelCase alias
   - 프론트엔드 코드: camelCase 사용
   - 속성명이 불분명할 때 실제 사용 코드 먼저 검색

3. **기본값 설정 주의**:
   - 매칭 실패 시 첫 번째 항목 사용 금지
   - 빈 문자열이나 null로 명시적으로 표시

---
