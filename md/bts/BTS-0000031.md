# BTS-0000031: 스케줄 시간이 과거로 설정되어 즉시 실행됨

**발생일:** 2025-12-03

**상태:** ✅ **해결됨**

**심각도:** 🔴 **CRITICAL** - 스케줄 기능 완전 무용지물

**증상:**
- 미래 시간으로 스케줄 설정했는데 과거 시간(2025. 12. 2. 오후 4:37:00)으로 저장됨
- 즉시 processing 상태로 변경되어 실행됨
- 예약 기능이 동작하지 않음

**근본 원인:**
- **이중 시간 변환 문제**: API route와 addSchedule 함수에서 중복 변환
- API route에서 `toMysqlDatetime()`로 문자열 변환 → addSchedule에서 다시 `new Date()` → 다시 문자열
- `new Date("YYYY-MM-DD HH:MM:SS")` 파싱 시 시간대 문제 발생
- 서버와 클라이언트 시간대 차이로 날짜가 하루 뒤로 밀림

**수정 방법:**
`src/lib/automation.ts:811-814, 835-837` - 이중 변환 제거

```typescript
// ❌ 잘못된 코드 (이중 변환)
const d = new Date(data.scheduledTime); // 문자열 → Date
const scheduledMysqlDatetime = `${d.getFullYear()}-...`; // Date → 문자열

// ✅ 올바른 코드
const scheduledMysqlDatetime = data.scheduledTime; // 문자열 그대로 사용
```

**재발 방지:**
- API route에서 이미 MySQL datetime 형식으로 변환됨
- addSchedule에서는 받은 문자열을 그대로 사용
- Date 객체 변환 시 항상 timezone 확인

**관련 파일:**
- `src/lib/automation.ts:811-814, 835-837`
- `src/app/api/automation/schedules/route.ts:12-14, 78-79`

---
