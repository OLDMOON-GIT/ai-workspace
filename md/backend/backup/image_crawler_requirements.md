# 이미지 크롤러 기능 명세서

## 1. ImageFX + Whisk 모드

### 1.1 ImageFX (첫 이미지 생성)
1. **비율 선택**
   - 가로/세로 모드 버튼 클릭
   - 셀렉트박스에서 선택:
     - 가로 모드: 16:9
     - 세로 모드: 9:16

2. **프롬프트 입력**
   - 첫 번째 씬의 프롬프트 입력
   - 입력 확인 (전체 텍스트 입력 여부)

3. **이미지 생성 및 다운로드**
   - 생성된 4개 이미지 중 랜덤으로 1개 다운로드
   - 다운로드 완료 확인

### 1.2 Whisk (피사체 업로드 및 나머지 이미지 생성)

#### A. 피사체 업로드
1. **이미지 추가 버튼 클릭**
   - 프롬프트 입력창 주변의 "이미지 추가" 버튼 찾기

2. **피사체(사람 얼굴) 박스 선택**
   - 피사체 영역 클릭
   - 파일 다이얼로그에서 ImageFX 다운로드 이미지 선택

3. **비율 선택**
   - 가로 모드(16:9) 또는 세로 모드(9:16) 선택

#### B. 각 씬별 이미지 생성
1. **프롬프트 입력**
   - 씬별 프롬프트 입력
   - Enter 키로 생성 시작

2. **이미지 생성 대기**
   - 정책 위반 체크
   - 이미지 생성 완료 대기

3. **이미지 다운로드**
   - **2개 생성**: 랜덤으로 1개 선택하여 다운로드
   - **1개 생성**: 해당 이미지 다운로드 (정책 위반 일부)
   - **0개 생성**: 정책 위반으로 재시도 필요

4. **정책 위반 처리**
   - 0개 생성 시: 프롬프트 수정 후 재시도 (최대 2회)
   - 재시도 시 프롬프트 간소화/수정

5. **다음 씬 진행**
   - 모든 씬에 대해 반복

## 2. Whisk 전용 모드

### 2.1 차이점
- ImageFX 단계 제외
- 피사체 업로드 없음
- 바로 Whisk에서 시작

### 2.2 프로세스
1. **Whisk 페이지 접속**
2. **비율 선택** (16:9 또는 9:16)
3. **각 씬별 프롬프트 입력 및 이미지 생성**
   - 프롬프트 입력
   - 이미지 생성 대기
   - 다운로드 (2개 중 1개 랜덤, 또는 1개)
   - 0개인 경우 재시도 (최대 2회)
4. **모든 씬 완료까지 반복**

## 3. 공통 기능

### 3.1 정책 위반 처리 로직
```
IF 이미지 개수 == 0:
    FOR 재시도 횟수 (최대 2회):
        프롬프트 수정 (간소화/순화)
        재입력
        IF 이미지 생성 성공:
            BREAK
    END FOR
ELIF 이미지 개수 == 1:
    해당 이미지 다운로드
ELIF 이미지 개수 >= 2:
    랜덤으로 1개 선택하여 다운로드
END IF
```

### 3.2 이미지 선택 알고리즘
- 2개 이상: `Math.floor(Math.random() * 이미지개수)`로 선택
- 1개: 해당 이미지 선택
- 0개: 정책 위반 처리

### 3.3 비율 설정
- Longform (가로): 16:9
- Shortform (세로): 9:16
- Product (세로): 9:16

## 4. 기술 구현 세부사항

### 4.1 ImageFX 구현
- 가로/세로 모드 버튼: `button` 또는 `[role="button"]` 선택
- 셀렉트박스: 클릭 후 옵션 선택
- 프롬프트: contenteditable div에 입력
- 다운로드: 4개 중 랜덤 선택

### 4.2 Whisk 구현
- 이미지 추가: 프롬프트 입력창 주변 버튼
- 피사체 박스: 왼쪽 사이드바의 첫 번째 점선 박스
- 비율 선택: 드롭다운 메뉴
- 이미지 수집: 생성된 이미지 중 랜덤 선택

### 4.3 에러 처리
- 정책 위반: 프롬프트 수정 후 재시도
- 업로드 실패: pyautogui 사용
- 타임아웃: 최대 대기 시간 설정

## 5. 테스트 체크리스트

- [ ] ImageFX 가로/세로 모드 선택
- [ ] ImageFX 프롬프트 전체 입력
- [ ] ImageFX 4개 중 랜덤 다운로드
- [ ] Whisk 피사체 업로드
- [ ] Whisk 비율 선택
- [ ] Whisk 프롬프트 입력
- [ ] 2개 이미지 중 랜덤 선택
- [ ] 1개 이미지 다운로드
- [ ] 0개 이미지 재시도 (최대 2회)
- [ ] 전체 씬 순차 처리