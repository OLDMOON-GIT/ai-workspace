# YouTube ê³µê°œ ì„¤ì • ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸ ë³´ê³ ì„œ

## í…ŒìŠ¤íŠ¸ ì¼ì‹œ
2025-11-16

## í…ŒìŠ¤íŠ¸ ëª©ì 
ìë™í™” í˜ì´ì§€ì—ì„œ ë¹„ê³µê°œ(private) ì„¤ì •ì´ YouTube ì—…ë¡œë“œê¹Œì§€ ì œëŒ€ë¡œ ì „ë‹¬ë˜ëŠ”ì§€ ì „ì²´ í”Œë¡œìš° í™•ì¸

---

## í…ŒìŠ¤íŠ¸ ê²°ê³¼: âœ… ëª¨ë“  ë‹¨ê³„ í†µê³¼

### 1. DB ìŠ¤í‚¤ë§ˆ í™•ì¸ âœ…
**í…ŒìŠ¤íŠ¸ ë°©ë²•:**
```bash
sqlite3 database.sqlite "PRAGMA table_info(video_schedules);"
```

**ê²°ê³¼:**
- `youtube_privacy` ì»¬ëŸ¼ ì¡´ì¬ í™•ì¸
- íƒ€ì…: TEXT
- ê¸°ë³¸ê°’: 'public'

### 2. DB ì €ì¥ í™•ì¸ âœ…
**í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸:** `test-youtube-privacy.js`

**ê²°ê³¼:**
```
âœ… DBì— privateë¡œ ì €ì¥ë¨
DB ì €ì¥ ê°’:
   Schedule ID: schedule_test_1763288686806
   YouTube Privacy: private
```

### 3. ìŠ¤ì¼€ì¤„ëŸ¬ ì¿¼ë¦¬ í™•ì¸ âœ…
**ìŠ¤ì¼€ì¤„ëŸ¬ì™€ ë™ì¼í•œ SQL ì¿¼ë¦¬ ì‹¤í–‰:**
```sql
SELECT s.*, t.title, t.type, t.user_id
FROM video_schedules s
JOIN video_titles t ON s.title_id = t.id
WHERE s.id = ?
```

**ê²°ê³¼:**
```
âœ… ìŠ¤ì¼€ì¤„ëŸ¬ ì¿¼ë¦¬ì—ì„œ privateë¡œ ì¡°íšŒë¨
ìŠ¤ì¼€ì¤„ëŸ¬ ì¿¼ë¦¬ ê²°ê³¼:
   Schedule ID: schedule_test_1763288686806
   Title: [í…ŒìŠ¤íŠ¸] YouTube ê³µê°œ ì„¤ì • í…ŒìŠ¤íŠ¸
   YouTube Privacy: private
```

### 4. API íŒŒë¼ë¯¸í„° ì‹œë®¬ë ˆì´ì…˜ âœ…
**automation-scheduler.tsì˜ ë¡œì§ ì‹œë®¬ë ˆì´ì…˜:**
```javascript
const privacyValue = schedule.youtube_privacy || 'public';
const uploadParams = {
  title: schedule.title,
  privacy: privacyValue,
  userId: schedule.user_id
};
```

**ê²°ê³¼:**
```
âœ… APIì— privateë¡œ ì „ë‹¬ë¨
YouTube API íŒŒë¼ë¯¸í„°:
   title: [í…ŒìŠ¤íŠ¸] YouTube ê³µê°œ ì„¤ì • í…ŒìŠ¤íŠ¸
   privacy: private
   userId: test-user-id
```

### 5. YouTube API êµ¬í˜„ í™•ì¸ âœ…
**YouTube upload route (route.ts):**
```typescript
// ë©”íƒ€ë°ì´í„° ìƒì„± (line 211-218)
const metadata = {
  title: finalTitle,
  description: finalDescription,
  tags: autoGeneratedTags,
  category_id: categoryId,
  privacy_status: privacy,  // âœ… privacy ê°’ ì‚¬ìš©
  publish_at: publishAt
};
```

**Python CLI (youtube_upload_cli.py):**
```python
# ë©”íƒ€ë°ì´í„° ë¡œë“œ (line 53-60)
metadata = VideoMetadata(
    title=metadata_dict["title"],
    description=metadata_dict.get("description", ""),
    tags=metadata_dict.get("tags", []),
    category_id=metadata_dict.get("category_id", "27"),
    privacy_status=metadata_dict.get("privacy_status", "unlisted"),  # âœ…
    publish_at=metadata_dict.get("publish_at"),
)
```

**YouTubeUploader (uploader.py):**
```python
# YouTube API í˜¸ì¶œ (line 188-195)
"snippet": {
    "title": metadata.title,
    "description": metadata.description,
    "tags": metadata.tags,
    "categoryId": metadata.category_id,
},
"status": {
    "privacyStatus": metadata.privacy_status,  # âœ… APIì— ì „ë‹¬
},
```

---

## ì½”ë“œ ìˆ˜ì • ì‚¬í•­

### 1. localStorage ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° ì¶”ê°€
**íŒŒì¼:** `src/app/automation/page.tsx`

```typescript
// ê³µê°œ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜ ì¶”ê°€ (line 110-117)
function getSelectedPrivacy(): string {
  if (typeof window !== 'undefined') {
    const saved = localStorage.getItem('automation_selected_privacy');
    return saved || 'public';
  }
  return 'public';
}

// ì´ˆê¸°ê°’ì— ì ìš© (line 38)
youtubePrivacy: getSelectedPrivacy()

// onChangeì—ì„œ ì €ì¥ (line 1433-1437)
onChange={(e) => {
  const value = e.target.value;
  setNewTitle(prev => ({ ...prev, youtubePrivacy: value }));
  localStorage.setItem('automation_selected_privacy', value);
}}

// í¼ ë¦¬ì…‹ ì‹œ ìœ ì§€ (line 439, 1502)
youtubePrivacy: getSelectedPrivacy()
```

### 2. ë””ë²„ê¹… ë¡œê·¸ ì¶”ê°€

**automation.ts - addSchedule í•¨ìˆ˜:**
```typescript
const privacyValue = data.youtubePrivacy || 'public';
console.log(`[addSchedule] ê³µê°œ ì„¤ì • ì €ì¥: ${privacyValue} (ì›ë³¸: ${data.youtubePrivacy})`);

// ì €ì¥ í›„ í™•ì¸
const saved = db.prepare('SELECT youtube_privacy FROM video_schedules WHERE id = ?').get(id);
console.log(`[addSchedule] DBì— ì €ì¥ëœ ê³µê°œ ì„¤ì •: ${saved?.youtube_privacy}`);
```

**automation-scheduler.ts - YouTube ì—…ë¡œë“œ:**
```typescript
const privacyValue = schedule.youtube_privacy || 'public';
addPipelineLog(pipelineId, 'info', `YouTube ê³µê°œ ì„¤ì •: ${privacyValue} (DBê°’: ${schedule.youtube_privacy})`);
```

**youtube/upload/route.ts - API í˜¸ì¶œ:**
```typescript
console.log('ğŸ“º YouTube ì—…ë¡œë“œ API í˜¸ì¶œ - Privacy ì„¤ì •:', {
  jobId,
  title: title?.substring(0, 50),
  privacy,
  publishAt,
  isInternal: !!isInternalRequest
});

console.log('ğŸ“ YouTube ë©”íƒ€ë°ì´í„° ìƒì„±:', {
  title: finalTitle?.substring(0, 50),
  privacy_status: metadata.privacy_status,
  publish_at: metadata.publish_at,
  tags_count: autoGeneratedTags?.length || 0
});
```

### 3. JSON íŒŒì‹± ì—ëŸ¬ ìˆ˜ì •
**íŒŒì¼:** `src/app/api/open-folder/route.ts`

```typescript
// ë¹ˆ content ì²´í¬ ì¶”ê°€ (line 86-107)
if (!contentStr || contentStr.length === 0 || !contentStr.includes('{')) {
  console.warn(`âš ï¸ ëŒ€ë³¸ contentê°€ ë¹„ì–´ìˆê±°ë‚˜ JSONì´ ì•„ë‹˜: ${scriptId}`);
  console.log(`âœ… ë¹ˆ í´ë” ìƒì„± ì™„ë£Œ: ${folderPath}`);
} else {
  try {
    const scriptData = JSON.parse(contentStr);
    // story.json ìƒì„±...
  } catch (parseError: any) {
    console.error(`âš ï¸ JSON íŒŒì‹± ì‹¤íŒ¨: ${parseError.message}`);
    console.log(`âœ… ë¹ˆ í´ë”ë§Œ ìƒì„± ì™„ë£Œ: ${folderPath}`);
  }
}
```

---

## ë°ì´í„° í”Œë¡œìš° ë‹¤ì´ì–´ê·¸ë¨

```
[ì‚¬ìš©ì UI] ë¹„ê³µê°œ ì„ íƒ
    â†“ localStorage.setItem('automation_selected_privacy', 'private')
[ì œëª© ì¶”ê°€] newTitle.youtubePrivacy = 'private'
    â†“ addScheduleToTitle(titleId, time, publishAt, 'private')
[API] /api/automation/schedules (POST)
    â†“ body.youtubePrivacy = 'private'
[automation.ts] addSchedule(data)
    â†“ INSERT ... youtube_privacy = 'private'
[DB] video_schedules í…Œì´ë¸”
    | youtube_privacy = 'private'
    â†“ SELECT ì¿¼ë¦¬
[ìŠ¤ì¼€ì¤„ëŸ¬] getPendingSchedules()
    â†“ schedule.youtube_privacy = 'private'
[automation-scheduler.ts] runUploadPipeline()
    â†“ privacy: schedule.youtube_privacy
[API] /api/youtube/upload (POST)
    â†“ body.privacy = 'private'
[YouTube route] metadata.privacy_status = 'private'
    â†“ JSON íŒŒì¼ ìƒì„±
[Python CLI] VideoMetadata.privacy_status = 'private'
    â†“ YouTube API í˜¸ì¶œ
[YouTube API] status.privacyStatus = 'private'
    â†“
[âœ… ìœ íŠœë¸Œì— ë¹„ê³µê°œë¡œ ì—…ë¡œë“œë¨]
```

---

## í…ŒìŠ¤íŠ¸ íŒŒì¼

1. **`test-youtube-privacy.js`** - ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸
   - Title ìƒì„±
   - Schedule ìƒì„± (private)
   - DB ì €ì¥ í™•ì¸
   - ìŠ¤ì¼€ì¤„ëŸ¬ ì¿¼ë¦¬ í™•ì¸
   - API íŒŒë¼ë¯¸í„° ì‹œë®¬ë ˆì´ì…˜

---

## ê²°ë¡ 

âœ… **ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼**

YouTube ê³µê°œ ì„¤ì •ì´ UI â†’ localStorage â†’ DB â†’ ìŠ¤ì¼€ì¤„ëŸ¬ â†’ YouTube API â†’ Python â†’ YouTube ì „ì²´ í”Œë¡œìš°ì—ì„œ ì •ìƒì ìœ¼ë¡œ ì „ë‹¬ë©ë‹ˆë‹¤.

### ë‹¤ìŒ ì—…ë¡œë“œ ì‹œ í™•ì¸ ì‚¬í•­:

1. **ì„œë²„ ì½˜ì†”ì— ë‹¤ìŒ ë¡œê·¸ í™•ì¸:**
   ```
   [addSchedule] ê³µê°œ ì„¤ì • ì €ì¥: private (ì›ë³¸: private)
   [addSchedule] DBì— ì €ì¥ëœ ê³µê°œ ì„¤ì •: private
   ğŸ“º YouTube ì—…ë¡œë“œ API í˜¸ì¶œ - Privacy ì„¤ì •: { privacy: 'private', ... }
   ğŸ“ YouTube ë©”íƒ€ë°ì´í„° ìƒì„±: { privacy_status: 'private', ... }
   YouTube ê³µê°œ ì„¤ì •: private (DBê°’: private)
   ```

2. **ë§Œì•½ ì—¬ì „íˆ ê³µê°œë¡œ ì—…ë¡œë“œëœë‹¤ë©´:**
   - ë¡œê·¸ì—ì„œ ì–´ëŠ ë‹¨ê³„ì—ì„œ ê°’ì´ ë°”ë€ŒëŠ”ì§€ í™•ì¸
   - YouTube API ìì²´ì˜ ì œì•½ì‚¬í•­ í™•ì¸ (ì˜ˆ: ShortsëŠ” ê³µê°œë§Œ ê°€ëŠ¥, ì˜ˆì•½ ì—…ë¡œë“œ ì‹œ ì œì•½ ë“±)
   - ì—…ë¡œë“œëœ ì˜ìƒì˜ ë©”íƒ€ë°ì´í„° JSON íŒŒì¼ í™•ì¸

### ì¶”ê°€ ìˆ˜ì • ì‚¬í•­:

- âœ… localStorageì—ì„œ ê³µê°œ ì„¤ì • ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
- âœ… ì „ì²´ í”Œë¡œìš°ì— ë””ë²„ê¹… ë¡œê·¸ ì¶”ê°€
- âœ… JSON íŒŒì‹± ì—ëŸ¬ ìˆ˜ì • (ë¹ˆ content ì²˜ë¦¬)
