# 🎯 고품질 제목 풀 시스템 가이드

## 개요

Ollama 로컬 LLM으로 대량 제목 생성 → 규칙 기반 평가 → 90점 이상만 저장하여 **무료 고품질 제목 풀 구축**

## 장점

✅ **비용 절감**: Ollama 로컬 실행으로 무료
✅ **품질 보장**: 90점 이상만 저장
✅ **중복 제거**: 유사도 체크로 유니크한 제목만 저장
✅ **빠른 선택**: 실시간 AI 생성 없이 풀에서 즉시 선택

## 시스템 구조

```
┌─────────────────────────────────────────────┐
│  1단계: Ollama 배치 생성 (무료)            │
│  - 카테고리별 1000개 제목 생성             │
│  - 규칙 기반 평가로 90점 이상 필터링       │
│  - 유사도 체크로 중복 제거                  │
│  - title_pool DB에 저장                     │
└─────────────────────────────────────────────┘
                    ⬇
┌─────────────────────────────────────────────┐
│  2단계: 자동화에서 제목 선택               │
│  - 풀에서 미사용 90점+ 제목 우선 선택      │
│  - 풀이 비면 AI로 실시간 생성 (폴백)       │
│  - 사용된 제목은 used=1로 표시             │
└─────────────────────────────────────────────┘
```

## 설치 및 실행

### 1. Ollama 설치

```bash
# Windows
winget install Ollama.Ollama

# macOS
brew install ollama

# Linux
curl -fsSL https://ollama.com/install.sh | sh
```

### 2. 모델 다운로드

```bash
# Qwen 2.5 7B (추천 - 한국어 우수)
ollama pull qwen2.5:7b

# 또는 Llama 3.1 8B
ollama pull llama3.1:8b
```

### 3. Ollama 서버 시작

```bash
ollama serve
```

### 4. 배치 생성 실행

```bash
node batch-generate-titles.js
```

## 설정

`batch-generate-titles.js` 파일에서 설정 변경:

```javascript
const OLLAMA_MODEL = 'qwen2.5:7b'; // 사용할 모델
const BATCH_SIZE = 100; // 배치당 생성 개수
const MIN_SCORE = 90; // 최소 점수 (90점 이상만 저장)
const CATEGORIES = [
  '시니어사연',
  '복수극',
  '탈북자사연',
  '막장드라마'
];
```

## 배치 생성 출력 예시

```
🚀 Ollama 배치 제목 생성 시작...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📂 카테고리: 탈북자사연
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📊 기존 제목 수: 0개

[배치 1/10] 100개 생성 중...
✅ 100개 생성 완료
🎯 90점 이상: 23개
  ✓ [95점] 북한을 탈출한 후 겪은 충격적인 남한 생활, 자유의 진짜 대가는?
  ✓ [93점] 탈북 후 10년, 이제야 밝히는 북한의 숨겨진 진실
  ✓ [92점] 북한에서는 상상도 못한 남한의 자유, 그리고 그 댓가
💾 저장: 23개 (중복 0개)

...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🎉 배치 생성 완료!
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 생성된 제목: 4000개
🎯 90점 이상: 892개
💾 저장된 제목: 856개
🔄 중복 제거: 36개
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

## 자동화 통합

제목 풀이 구축되면, 자동화 시스템이 자동으로:

1. **풀 우선 사용**: 90점 이상 미사용 제목을 풀에서 선택
2. **비용 $0**: AI API 호출 없이 즉시 선택
3. **폴백 처리**: 풀이 비면 AI로 실시간 생성

로그 예시:
```
[TitlePool] Checking title pool for category "탈북자사연"...
[TitlePool] ✅ Found high-quality title from pool (score: 95)
[TitlePool] Title: "북한을 탈출한 후 겪은 충격적인 남한 생활, 자유의 진짜 대가는?"
```

## 제목 풀 통계 확인

```javascript
const { getTitlePoolStats } = require('./trend-video-frontend/src/lib/automation');

const stats = getTitlePoolStats();
console.log(stats);

// 출력:
// [
//   {
//     category: '탈북자사연',
//     total: 234,
//     unused: 189,
//     avg_score: 92.5,
//     max_score: 98
//   },
//   ...
// ]
```

## 점수 평가 기준

| 기준 | 배점 | 설명 |
|------|------|------|
| 제목 길이 (20-60자) | 30점 | 최적 길이 |
| 특수문자 (?, !, ...) | 28점 | 호기심 유발 |
| 감정 키워드 | 20점 | 후회, 복수, 반전 등 |
| 숫자 포함 | 8점 | 구체성 |
| 카테고리 키워드 | 15점 | 탈북, 북한 등 |
| 문장 구조 | 7점 | 쉼표 개수 |
| **합계** | **108점** | (최대 100점으로 제한) |

## 팁

1. **정기적 배치 실행**: 주 1회 배치 생성으로 풀 유지
2. **모델 선택**: `qwen2.5:7b`가 한국어에 최적화
3. **점수 조정**: MIN_SCORE를 85-95 사이로 조정 가능
4. **카테고리 추가**: CATEGORIES 배열에 원하는 카테고리 추가

## 트러블슈팅

### Ollama 연결 실패
```bash
# Ollama 서버가 실행 중인지 확인
curl http://localhost:11434/api/tags
```

### 생성 속도가 느림
- GPU가 있는 경우 자동으로 사용됨
- CPU만 있는 경우 `qwen2.5:3b` 같은 작은 모델 사용

### 중복 제목이 많음
- 유사도 임계값 조정: `if (similarity > 0.7)` → `0.6`으로 낮춤

## 비용 비교

| 방식 | 1000개 제목 비용 | 품질 |
|------|------------------|------|
| Claude API | ~$5-10 | ⭐⭐⭐⭐⭐ |
| ChatGPT API | ~$8-15 | ⭐⭐⭐⭐ |
| Ollama 로컬 | **$0** | ⭐⭐⭐⭐ (90점 필터링) |

## 다음 단계

1. ✅ Ollama 설치 및 모델 다운로드
2. ✅ 배치 생성 스크립트 실행
3. ✅ 제목 풀 통계 확인
4. ✅ 자동화 시스템에서 풀 사용 확인

질문이나 문제가 있으면 이슈를 남겨주세요!
