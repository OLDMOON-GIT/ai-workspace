# 리그레션 테스트 체크리스트

> 작성일: 2025-11-04
> 버전: v1.0
> 목적: 모든 핵심 기능에 대한 포괄적인 리그레션 테스트 커버리지 확보

---

## 📊 현재 테스트 현황

### Frontend
- **현재 테스트:** 87개 통과
- **커버리지:** 기본 기능, Admin 페이지, 파일 정렬, 아키텍처

### Backend
- **현재 테스트:** 56개 통과, 2개 스킵
- **커버리지:** 보안, 데이터 무결성, 비디오 생성, TTS

---

## 🎯 Frontend 리그레션 테스트 목록

### ✅ 완료된 테스트
- [x] 파일 정렬 (file-sorting.test.ts) - 4개
- [x] JSON 제목 추출 (json-title-extraction.test.ts) - 4개
- [x] 비디오 포맷 선택 (videoFormat.test.ts) - 35개
- [x] 아키텍처 페이지 (architecture.test.ts) - 18개
- [x] 크레딧 설정 (settings.test.ts) - 18개
- [x] 사용자 관리 (users.test.ts) - 26개

### ⏳ 작성 필요 (우선순위 높음)

#### 1. 인증 및 권한 (auth/)
- [ ] 회원가입 프로세스
  - 이메일 형식 검증
  - 비밀번호 강도 체크
  - 중복 이메일 방지
  - 이메일 인증 메일 발송
- [ ] 로그인 프로세스
  - 올바른 자격 증명으로 로그인
  - 잘못된 자격 증명 거부
  - 세션 쿠키 생성
  - 인증되지 않은 이메일 로그인 방지
- [ ] 로그아웃 프로세스
  - 세션 종료
  - 쿠키 삭제
- [ ] 이메일 인증
  - 유효한 토큰으로 인증
  - 만료된 토큰 거부
  - 중복 인증 방지

#### 2. 크레딧 시스템 (credits/)
- [ ] 크레딧 조회
  - 현재 잔액 표시
  - 사용 내역 조회
- [ ] 크레딧 충전 요청
  - 충전 요청 생성
  - 입금자명 필수 입력
  - 요청 상태 추적
- [ ] 크레딧 사용
  - 대본 생성 시 차감
  - 영상 생성 시 차감
  - 잔액 부족 시 거부

#### 3. 대본 생성 (scripts/)
- [ ] 대본 생성 요청
  - 제목 입력 검증
  - 비디오 타입 선택 (longform/shortform/sora2)
  - Claude local/remote 선택
  - 크레딧 차감 확인
- [ ] 대본 목록 조회
  - 사용자별 대본 필터링
  - 상태별 필터링 (PENDING/PROCESSING/COMPLETED/FAILED)
  - 페이지네이션
- [ ] 대본 상세 조회
  - 대본 내용 표시
  - 타임스탬프 파싱
  - JSON 구조 검증
- [ ] 대본 재생성
  - 실패한 대본 재시도
  - 기존 대본 덮어쓰기
- [ ] 대본 취소
  - 진행 중인 작업 취소
  - 상태 업데이트

#### 4. 영상 생성 (videos/)
- [ ] 영상 생성 요청
  - 대본 기반 생성
  - 이미지 업로드
  - TTS 옵션 선택
  - 크레딧 차감 확인
- [ ] 영상 목록 조회
  - 사용자별 영상 필터링
  - 상태별 필터링
  - 썸네일 표시
- [ ] 영상 다운로드
  - 완료된 영상 다운로드
  - 파일 크기 제한 체크
- [ ] 영상 재생성
  - 실패한 영상 재시도
- [ ] 영상 병합
  - 여러 씬 병합
  - 자막 추가
  - TTS 추가

#### 5. 콘텐츠 통합 관리 (my-content/)
- [ ] 콘텐츠 목록 조회
  - 대본 + 영상 통합 표시
  - 상태별 필터링
  - 검색 기능
- [ ] 콘텐츠 포맷 변환
  - longform ↔ shortform ↔ sora2
  - 변환 시 대본 재생성

#### 6. YouTube 연동 (youtube/)
- [ ] OAuth 인증
  - OAuth URL 생성
  - 콜백 처리
  - 토큰 저장
- [ ] 멀티 채널 관리
  - 채널 목록 조회
  - 기본 채널 설정
  - 채널 추가/삭제
- [ ] 영상 업로드
  - 메타데이터 입력 (제목, 설명, 태그)
  - 썸네일 업로드
  - 공개 범위 설정
  - 업로드 진행 상태 추적
- [ ] 업로드된 영상 조회
  - 업로드 이력
  - YouTube URL 링크

#### 7. Admin 페이지
- [ ] 충전 요청 관리 (charge-requests/)
  - 요청 목록 조회
  - 승인/거부 처리
  - 크레딧 자동 부여
- [ ] 사용자 활동 로그 (user-activity/)
  - 로그인 이력
  - 활동 시간 추적
  - 세션 모니터링
- [ ] 프롬프트 관리 (prompts/)
  - 롱폼/숏폼/SORA2 프롬프트 조회
  - 프롬프트 수정
  - 수정 이력 추적
- [ ] 작업 관리 (tasks/)
  - TODO 목록 조회
  - 작업 생성/수정/삭제
  - 상태 변경
- [ ] 대본 제목 등록 (titles/)
  - 제목 등록
  - 자동 대본 생성 트리거
- [ ] DB 백업 (backup/)
  - 백업 생성
  - 백업 목록 조회
  - 백업 복원
  - 백업 삭제
  - 무결성 체크
- [ ] YouTube Credentials (youtube-credentials/)
  - 공용 credentials 설정
  - client_id/client_secret 암호화 저장

#### 8. Coupang 제휴 (coupang/)
- [ ] 상품 검색
  - 키워드 검색
  - 카테고리 필터
- [ ] 딥링크 생성
  - 상품 URL → 딥링크 변환
  - 수수료율 계산
- [ ] 통계 조회
  - 클릭 수
  - 전환율
  - 수익 통계

#### 9. API 엔드포인트 통합 테스트
- [ ] /api/generate-script
  - 대본 생성 파이프라인
  - Claude API 연동
  - 타임아웃 처리
- [ ] /api/generate-video
  - 영상 생성 파이프라인
  - 이미지 처리
  - TTS 생성
- [ ] /api/pipeline
  - 대본+영상 통합 생성
  - 각 단계별 상태 업데이트
- [ ] /api/job-status
  - 작업 상태 폴링
  - 실시간 진행률
- [ ] /api/script-status
  - 대본 상태 조회

---

## 🎯 Backend 리그레션 테스트 목록

### ✅ 완료된 테스트
- [x] TTS 생성 (test_regression.py) - 3개
- [x] 썸네일 생성 (test_regression.py) - 2개
- [x] 롱폼/숏폼/SORA2 생성 (test_regression.py) - 3개
- [x] 영상 병합 (test_regression.py) - 1개 (스킵)
- [x] 프로세스 제어 (test_regression.py) - 2개
- [x] 파일 안전성 (test_regression.py) - 2개
- [x] API 보안 (test_api_security.py) - 20개
- [x] 데이터 무결성 (test_data_integrity.py) - 24개

### ⏳ 작성 필요 (우선순위 높음)

#### 1. AI 대본 생성 (ai_aggregator/)
- [ ] Claude Agent
  - 브라우저 자동화 (Selenium)
  - 대본 프롬프트 전송
  - 응답 파싱
  - 에러 핸들링 (로그인 실패, 타임아웃)
- [ ] ChatGPT Agent
  - API 호출
  - 응답 파싱
  - Rate limiting
- [ ] Gemini Agent
  - API 호출
  - 멀티모달 처리
- [ ] Grok Agent
  - API 호출
  - 응답 파싱
- [ ] Aggregator
  - 멀티 AI 병렬 요청
  - 결과 취합
  - 최적 응답 선택
- [ ] Queue Manager
  - 요청 큐잉
  - 우선순위 처리
  - 동시성 제어

#### 2. 영상 생성 (video_generator/)
- [ ] Story Video Creator (롱폼)
  - JSON 시나리오 파싱
  - 씬별 이미지 매칭
  - 씬별 TTS 생성
  - 씬별 영상 생성
  - 자막 생성 (ASS/SRT)
- [ ] Short Form Creator (숏폼)
  - 짧은 시나리오 처리
  - 빠른 영상 생성
  - 세로형 비율 (9:16)
- [ ] Video Merger
  - 여러 씬 병합
  - 오디오 동기화
  - 자막 오버레이
- [ ] Narrator (TTS)
  - OpenAI TTS API 호출
  - 음성 파일 생성
  - 길이 검증
  - 포맷 변환
- [ ] Transcriber (자막)
  - 타임스탬프 생성
  - ASS 포맷 생성
  - SRT 포맷 생성
  - 줄바꿈 처리
- [ ] Editor
  - FFmpeg 명령어 생성
  - 영상 인코딩
  - 해상도 조정
  - 비트레이트 설정
- [ ] Analyzer
  - 영상 길이 분석
  - 해상도 감지
  - 오디오 트랙 확인
  - 코덱 정보

#### 3. SORA2 생성 (sora/)
- [ ] Prompt Manager
  - 프롬프트 로드
  - 변수 치환
  - 프롬프트 검증
- [ ] API Client
  - SORA API 호출
  - 응답 파싱
  - 에러 핸들링
- [ ] Main
  - 전체 파이프라인
  - 프롬프트 → 영상 생성
  - 진행 상태 추적

#### 4. YouTube 업로드 (youtube/)
- [ ] Uploader
  - OAuth 토큰 갱신
  - 영상 업로드
  - 메타데이터 설정
  - 썸네일 업로드
  - 진행률 콜백
  - 에러 핸들링 (할당량 초과, 네트워크 오류)

#### 5. 프로세스 제어 (process_control.py)
- [ ] ProcessController
  - 프로세스 시작
  - 프로세스 중지
  - 상태 추적
  - 취소 시그널 전파
- [ ] Stop Signal Detection
  - 파일 기반 시그널
  - 주기적 체크
  - Graceful shutdown

#### 6. 파일 처리
- [ ] 이미지 처리
  - 업로드 검증
  - 포맷 변환
  - 리사이징
  - 메타데이터 제거
- [ ] 비디오 처리
  - 포맷 검증
  - 코덱 확인
  - 메타데이터 추출
- [ ] 자막 파일
  - ASS 파싱
  - SRT 파싱
  - 타임스탬프 변환
  - 인코딩 처리

#### 7. 에러 핸들링
- [ ] API 에러
  - 타임아웃
  - Rate limiting
  - 인증 실패
  - 서버 오류 (5xx)
- [ ] 파일 에러
  - 파일 없음
  - 권한 없음
  - 디스크 부족
- [ ] 외부 서비스 에러
  - Claude 연결 실패
  - OpenAI API 오류
  - YouTube API 오류
  - SORA API 오류

#### 8. 성능 테스트
- [ ] 대용량 파일 처리
  - 4K 영상 처리
  - 긴 대본 (100+ 씬)
  - 메모리 사용량
- [ ] 동시 요청 처리
  - 10명 동시 대본 생성
  - 5명 동시 영상 생성
  - 리소스 경쟁 처리
- [ ] 장시간 작업
  - 1시간 이상 영상 생성
  - 타임아웃 없이 완료
  - 진행 상태 유지

---

## 🔥 긴급 (Critical) 테스트

### Frontend
1. **인증 시스템** - 보안 핵심
2. **크레딧 시스템** - 금전 관련
3. **대본/영상 생성 파이프라인** - 핵심 기능

### Backend
1. **AI Agent 연동** - 서비스 근간
2. **영상 생성 파이프라인** - 핵심 기능
3. **YouTube 업로드** - 외부 연동

---

## 📝 테스트 작성 가이드

### 테스트 구조
```typescript
describe('기능명', () => {
  describe('하위 기능', () => {
    test('구체적인 동작 설명', () => {
      // Given (준비)
      const input = {...};

      // When (실행)
      const result = someFunction(input);

      // Then (검증)
      expect(result).toBe(expected);
    });
  });

  describe('Edge Cases', () => {
    // 엣지 케이스 테스트
  });

  describe('리그레션 방지', () => {
    test('[BUG FIX] 이전 버그 설명', () => {
      // 버그가 재발하지 않는지 검증
    });
  });
});
```

### 명명 규칙
- **파일명:** `기능명.test.ts` (Frontend), `test_기능명.py` (Backend)
- **테스트명:** 동사로 시작, 명확한 동작 설명
- **좋은 예:** `should generate script with valid title`
- **나쁜 예:** `test1`, `works`

### 커버리지 목표
- **최소:** 70% 코드 커버리지
- **목표:** 85% 코드 커버리지
- **Critical Path:** 100% 커버리지

---

## 📈 진행 상황 추적

### Frontend
- 완료: 87개 / 예상 200개 (43.5%)
- 우선순위 높음: 113개 작성 필요

### Backend
- 완료: 56개 / 예상 150개 (37.3%)
- 우선순위 높음: 94개 작성 필요

### 전체
- **현재:** 143개 테스트
- **목표:** 350개 테스트
- **진행률:** 40.9%

---

## ✅ 체크리스트 사용법

1. **테스트 작성 전:** 이 문서에서 작성할 항목 확인
2. **테스트 작성 중:** 체크박스 상태 업데이트 ([ ] → [x])
3. **테스트 완료 후:** 통과한 테스트 수 업데이트
4. **주기적 리뷰:** 매주 진행 상황 검토 및 우선순위 조정

---

## 🔄 업데이트 로그

- **2025-11-04:** 초안 작성, 현재 87개(Frontend) + 56개(Backend) = 143개 테스트 완료
