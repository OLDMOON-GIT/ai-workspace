<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Baccarat Analyzer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .btn-choice { transition: all 0.15s; }
    .btn-choice:hover { transform: scale(1.05); }
    .btn-choice:active { transform: scale(0.95); }
    .result-item { animation: fadeIn 0.2s ease; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
    .pulse { animation: pulse 1s infinite; }
  </style>
</head>
<body class="bg-gray-900 min-h-screen text-white">
  <div class="container mx-auto px-4 py-6 max-w-2xl">
    <!-- Header -->
    <div class="text-center mb-6">
      <h1 class="text-3xl font-bold">ğŸ° Baccarat Analyzer</h1>
      <p class="text-gray-400 text-sm mt-1">íŒ¨í„´ ë¶„ì„ ì¶”ì²œ ì‹œìŠ¤í…œ</p>
    </div>

    <!-- Recommendation Box -->
    <div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-6 mb-6 border border-gray-700">
      <div class="text-center">
        <div class="text-gray-400 text-sm mb-2">ë‹¤ìŒ ì¶”ì²œ</div>
        <div id="recommendation" class="text-7xl font-black mb-2 pulse">-</div>
        <div id="recommendationLabel" class="text-2xl font-semibold text-gray-300">ëŒ€ê¸°ì¤‘</div>
        <div class="mt-3 flex items-center justify-center gap-2">
          <span class="text-gray-400">ì‹ ë¢°ë„:</span>
          <span id="confidence" class="text-xl font-bold text-yellow-400">--%</span>
        </div>
        <div id="reason" class="text-sm text-gray-500 mt-2">ê²°ê³¼ë¥¼ ì…ë ¥í•˜ì„¸ìš”</div>
      </div>
    </div>

    <!-- Input Buttons -->
    <div class="bg-gray-800 rounded-xl p-4 mb-6">
      <div class="text-sm text-gray-400 mb-3 text-center">ê²°ê³¼ ì…ë ¥</div>
      <div class="flex gap-3 justify-center">
        <button onclick="addResult('P')" class="btn-choice bg-blue-600 hover:bg-blue-500 text-white text-2xl font-bold py-4 px-8 rounded-xl shadow-lg">
          P <span class="text-sm font-normal">Player</span>
        </button>
        <button onclick="addResult('T')" class="btn-choice bg-green-600 hover:bg-green-500 text-white text-2xl font-bold py-4 px-6 rounded-xl shadow-lg">
          T <span class="text-sm font-normal">Tie</span>
        </button>
        <button onclick="addResult('B')" class="btn-choice bg-red-600 hover:bg-red-500 text-white text-2xl font-bold py-4 px-8 rounded-xl shadow-lg">
          B <span class="text-sm font-normal">Banker</span>
        </button>
      </div>
      <div class="flex justify-center gap-4 mt-3">
        <button onclick="undoLast()" class="text-gray-400 hover:text-white text-sm">â†© ì‹¤í–‰ì·¨ì†Œ</button>
        <button onclick="showImportModal()" class="text-gray-400 hover:text-white text-sm">ğŸ“‹ ê¸°ë¡ì…ë ¥</button>
        <button onclick="clearAll()" class="text-red-400 hover:text-red-300 text-sm">ğŸ—‘ ì´ˆê¸°í™”</button>
      </div>
    </div>

    <!-- Stats -->
    <div class="grid grid-cols-4 gap-2 mb-6">
      <div class="bg-gray-800 rounded-lg p-3 text-center">
        <div id="statTotal" class="text-2xl font-bold">0</div>
        <div class="text-gray-500 text-xs">ì´</div>
      </div>
      <div class="bg-gray-800 rounded-lg p-3 text-center">
        <div id="statPlayer" class="text-2xl font-bold text-blue-400">0</div>
        <div class="text-gray-500 text-xs">Player</div>
      </div>
      <div class="bg-gray-800 rounded-lg p-3 text-center">
        <div id="statBanker" class="text-2xl font-bold text-red-400">0</div>
        <div class="text-gray-500 text-xs">Banker</div>
      </div>
      <div class="bg-gray-800 rounded-lg p-3 text-center">
        <div id="statTie" class="text-2xl font-bold text-green-400">0</div>
        <div class="text-gray-500 text-xs">Tie</div>
      </div>
    </div>

    <!-- Progress Bar -->
    <div class="bg-gray-800 rounded-lg p-3 mb-6">
      <div class="flex items-center gap-2">
        <span class="text-blue-400 text-sm w-8">P</span>
        <div class="flex-1 bg-gray-700 rounded-full h-3 overflow-hidden flex">
          <div id="playerBar" class="bg-blue-500 h-3 transition-all" style="width: 50%"></div>
          <div id="bankerBar" class="bg-red-500 h-3 transition-all" style="width: 50%"></div>
        </div>
        <span class="text-red-400 text-sm w-8 text-right">B</span>
      </div>
      <div class="flex justify-between text-xs text-gray-500 mt-1 px-8">
        <span id="playerPercent">50.0%</span>
        <span id="bankerPercent">50.0%</span>
      </div>
    </div>

    <!-- History -->
    <div class="bg-gray-800 rounded-xl p-4 mb-6">
      <div class="text-sm text-gray-400 mb-2">ê¸°ë¡ (ìµœê·¼ 40ê°œ)</div>
      <div id="history" class="flex flex-wrap gap-1.5 min-h-[60px]">
        <span class="text-gray-600">ê¸°ë¡ ì—†ìŒ</span>
      </div>
    </div>

    <!-- Strategies -->
    <div class="bg-gray-800 rounded-xl p-4">
      <div class="text-sm text-gray-400 mb-3">ì „ëµ ë¶„ì„</div>
      <div id="strategies" class="space-y-2">
        <div class="text-gray-600 text-sm">ê²°ê³¼ë¥¼ ì…ë ¥í•˜ë©´ ë¶„ì„ì´ ì‹œì‘ë©ë‹ˆë‹¤</div>
      </div>
    </div>

    <!-- Import Modal -->
    <div id="importModal" class="fixed inset-0 bg-black/70 flex items-center justify-center hidden z-50">
      <div class="bg-gray-800 rounded-xl p-6 w-full max-w-md mx-4">
        <h3 class="text-lg font-semibold mb-3">ê¸°ë¡ ì…ë ¥</h3>
        <p class="text-gray-400 text-sm mb-2">P, B, Të¥¼ ì—°ì† ì…ë ¥ (ì˜ˆ: PBBTPBBP)</p>
        <textarea id="importInput" placeholder="PBBTPBBP..." rows="3"
                  class="w-full bg-gray-700 rounded-lg px-4 py-3 mb-4 font-mono text-lg"></textarea>
        <div class="flex gap-2 justify-end">
          <button onclick="hideImportModal()" class="px-4 py-2 bg-gray-600 rounded-lg">ì·¨ì†Œ</button>
          <button onclick="importHistory()" class="px-4 py-2 bg-purple-600 rounded-lg">ì…ë ¥</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ê¸°ë¡ ì €ì¥ (localStorage)
    let history = JSON.parse(localStorage.getItem('baccaratHistory') || '[]');

    // ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', () => {
      updateUI();
    });

    // ê²°ê³¼ ì¶”ê°€
    function addResult(result) {
      history.push(result);
      saveAndUpdate();
    }

    // ì‹¤í–‰ì·¨ì†Œ
    function undoLast() {
      if (history.length > 0) {
        history.pop();
        saveAndUpdate();
      }
    }

    // ì´ˆê¸°í™”
    function clearAll() {
      if (confirm('ëª¨ë“  ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        history = [];
        saveAndUpdate();
      }
    }

    // ì €ì¥ ë° UI ì—…ë°ì´íŠ¸
    function saveAndUpdate() {
      localStorage.setItem('baccaratHistory', JSON.stringify(history));
      updateUI();
    }

    // UI ì—…ë°ì´íŠ¸
    function updateUI() {
      const analysis = analyze(history);

      // ì¶”ì²œ
      const recEl = document.getElementById('recommendation');
      const labelEl = document.getElementById('recommendationLabel');

      if (history.length < 3) {
        recEl.textContent = 'B';
        recEl.className = 'text-7xl font-black mb-2 text-red-400';
        labelEl.textContent = 'Banker (ê¸°ë³¸)';
      } else {
        recEl.textContent = analysis.recommendation;
        recEl.className = `text-7xl font-black mb-2 pulse ${analysis.recommendation === 'P' ? 'text-blue-400' : 'text-red-400'}`;
        labelEl.textContent = analysis.recommendation === 'P' ? 'Player' : 'Banker';
      }

      document.getElementById('confidence').textContent = analysis.confidence.toFixed(1) + '%';
      document.getElementById('reason').textContent = analysis.reason;

      // í†µê³„
      document.getElementById('statTotal').textContent = analysis.stats.totalRounds;
      document.getElementById('statPlayer').textContent = analysis.stats.playerWins;
      document.getElementById('statBanker').textContent = analysis.stats.bankerWins;
      document.getElementById('statTie').textContent = analysis.stats.ties;

      document.getElementById('playerBar').style.width = analysis.stats.playerPercent + '%';
      document.getElementById('bankerBar').style.width = analysis.stats.bankerPercent + '%';
      document.getElementById('playerPercent').textContent = analysis.stats.playerPercent.toFixed(1) + '%';
      document.getElementById('bankerPercent').textContent = analysis.stats.bankerPercent.toFixed(1) + '%';

      // ê¸°ë¡
      const historyEl = document.getElementById('history');
      if (history.length === 0) {
        historyEl.innerHTML = '<span class="text-gray-600">ê¸°ë¡ ì—†ìŒ</span>';
      } else {
        const recent = history.slice(-40);
        historyEl.innerHTML = recent.map((r, i) => {
          const colors = { P: 'bg-blue-600', B: 'bg-red-600', T: 'bg-green-600' };
          return `<span class="result-item ${colors[r]} w-7 h-7 rounded flex items-center justify-center text-xs font-bold">${r}</span>`;
        }).join('');
      }

      // ì „ëµ
      const strategiesEl = document.getElementById('strategies');
      if (analysis.strategies.length > 0) {
        strategiesEl.innerHTML = analysis.strategies.map(s => {
          const color = s.recommendation === 'P' ? 'text-blue-400' : 'text-red-400';
          const barWidth = Math.min(s.confidence, 100);
          return `
            <div class="bg-gray-700/50 rounded-lg p-2">
              <div class="flex items-center justify-between mb-1">
                <span class="text-sm">${s.name}</span>
                <span class="${color} font-bold">${s.recommendation} <span class="text-gray-400 font-normal">(${s.confidence.toFixed(0)}%)</span></span>
              </div>
              <div class="bg-gray-600 rounded-full h-1.5 mb-1">
                <div class="${s.recommendation === 'P' ? 'bg-blue-500' : 'bg-red-500'} h-1.5 rounded-full" style="width: ${barWidth}%"></div>
              </div>
              <div class="text-xs text-gray-500">${s.description}</div>
            </div>
          `;
        }).join('');
      } else {
        strategiesEl.innerHTML = '<div class="text-gray-600 text-sm">ê²°ê³¼ë¥¼ ì…ë ¥í•˜ë©´ ë¶„ì„ì´ ì‹œì‘ë©ë‹ˆë‹¤</div>';
      }
    }

    // ë¶„ì„ í•¨ìˆ˜ (í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ)
    function analyze(history) {
      const stats = getStats(history);

      if (history.length < 3) {
        return {
          recommendation: 'B',
          confidence: 50.68,
          reason: 'ë°ì´í„° ë¶€ì¡± - Banker ê¸°ë³¸ ì„ íƒ',
          strategies: [],
          stats
        };
      }

      const strategies = [
        strategyPatternMatch(history),
        strategyStreakReversal(history, stats),
        strategyZigzag(history),
        strategyRecentTrend(history),
        { name: 'í•˜ìš°ìŠ¤ ì—£ì§€', recommendation: 'B', confidence: 50.68, description: 'Banker í†µê³„ì  ìš°ìœ„' }
      ];

      // ê°€ì¤‘ íˆ¬í‘œ
      const weights = [2.0, 1.5, 1.2, 1.3, 0.5];
      let pScore = 0, bScore = 0;

      strategies.forEach((s, i) => {
        const weight = weights[i] * (s.confidence / 100);
        if (s.recommendation === 'P') pScore += weight;
        else bScore += weight;
      });

      const recommendation = pScore > bScore ? 'P' : 'B';
      const confidence = (Math.max(pScore, bScore) / (pScore + bScore)) * 100;
      const bestStrategy = strategies.reduce((a, b) => a.confidence > b.confidence ? a : b);

      return {
        recommendation,
        confidence,
        reason: bestStrategy.description,
        strategies: strategies.sort((a, b) => b.confidence - a.confidence),
        stats
      };
    }

    function getStats(history) {
      const total = history.length;
      const playerWins = history.filter(r => r === 'P').length;
      const bankerWins = history.filter(r => r === 'B').length;
      const ties = history.filter(r => r === 'T').length;
      const nonTie = playerWins + bankerWins;

      return {
        totalRounds: total,
        playerWins,
        bankerWins,
        ties,
        playerPercent: nonTie > 0 ? (playerWins / nonTie) * 100 : 50,
        bankerPercent: nonTie > 0 ? (bankerWins / nonTie) * 100 : 50
      };
    }

    function strategyPatternMatch(history) {
      const filtered = history.filter(r => r !== 'T').join('');
      let best = { pattern: '', nextP: 0, nextB: 0, total: 0 };

      for (const len of [3, 4, 5, 6]) {
        if (filtered.length < len + 1) continue;
        const current = filtered.slice(-len);
        let p = 0, b = 0;

        for (let i = 0; i <= filtered.length - len - 1; i++) {
          if (filtered.slice(i, i + len) === current) {
            const next = filtered[i + len];
            if (next === 'P') p++;
            else if (next === 'B') b++;
          }
        }

        if (p + b > best.total) best = { pattern: current, nextP: p, nextB: b, total: p + b };
      }

      if (best.total >= 2) {
        const rec = best.nextP > best.nextB ? 'P' : 'B';
        const max = Math.max(best.nextP, best.nextB);
        return {
          name: 'íŒ¨í„´ ë§¤ì¹­',
          recommendation: rec,
          confidence: (max / best.total) * 100,
          description: `íŒ¨í„´ "${best.pattern}" â†’ ${rec} (${best.total}íšŒ ì¤‘ ${max}íšŒ)`
        };
      }
      return { name: 'íŒ¨í„´ ë§¤ì¹­', recommendation: 'B', confidence: 50, description: 'ë§¤ì¹­ íŒ¨í„´ ì—†ìŒ' };
    }

    function strategyStreakReversal(history, stats) {
      const filtered = history.filter(r => r !== 'T');
      if (filtered.length === 0) return { name: 'ì—°ì† ë°˜ì „', recommendation: 'B', confidence: 50, description: 'ë°ì´í„° ì—†ìŒ' };

      const last = filtered[filtered.length - 1];
      let count = 0;
      for (let i = filtered.length - 1; i >= 0; i--) {
        if (filtered[i] === last) count++;
        else break;
      }

      if (count >= 4) {
        const rec = last === 'P' ? 'B' : 'P';
        return {
          name: 'ì—°ì† ë°˜ì „',
          recommendation: rec,
          confidence: Math.min(50 + (count - 4) * 8, 75),
          description: `${count}ì—°ì† ${last} â†’ ë°˜ì „ ì˜ˆì¸¡`
        };
      }

      if (count >= 2) {
        return {
          name: 'ì—°ì† ë°˜ì „',
          recommendation: last,
          confidence: 55,
          description: `${count}ì—°ì† ${last} â†’ ì¶”ì„¸ ìœ ì§€`
        };
      }

      return { name: 'ì—°ì† ë°˜ì „', recommendation: 'B', confidence: 50, description: 'ì—°ì† íŒ¨í„´ ì—†ìŒ' };
    }

    function strategyZigzag(history) {
      const recent = history.filter(r => r !== 'T').slice(-6);
      if (recent.length < 4) return { name: 'ì§€ê·¸ì¬ê·¸', recommendation: 'B', confidence: 50, description: 'ë°ì´í„° ë¶€ì¡±' };

      let zigzag = 0;
      for (let i = 1; i < recent.length; i++) {
        if (recent[i] !== recent[i - 1]) zigzag++;
      }

      const ratio = zigzag / (recent.length - 1);
      if (ratio >= 0.7) {
        const last = recent[recent.length - 1];
        const rec = last === 'P' ? 'B' : 'P';
        return {
          name: 'ì§€ê·¸ì¬ê·¸',
          recommendation: rec,
          confidence: 60 + ratio * 15,
          description: `êµëŒ€ íŒ¨í„´ ê°ì§€ (${(ratio * 100).toFixed(0)}%)`
        };
      }

      return { name: 'ì§€ê·¸ì¬ê·¸', recommendation: 'B', confidence: 50, description: 'êµëŒ€ íŒ¨í„´ ì—†ìŒ' };
    }

    function strategyRecentTrend(history) {
      const recent = history.filter(r => r !== 'T').slice(-10);
      if (recent.length < 5) return { name: 'ìµœê·¼ íŠ¸ë Œë“œ', recommendation: 'B', confidence: 50, description: 'ë°ì´í„° ë¶€ì¡±' };

      const p = recent.filter(r => r === 'P').length;
      const pPct = (p / recent.length) * 100;

      if (pPct >= 65) {
        return { name: 'ìµœê·¼ íŠ¸ë Œë“œ', recommendation: 'P', confidence: pPct, description: `ìµœê·¼ Player ${p}/${recent.length} (${pPct.toFixed(0)}%)` };
      } else if (pPct <= 35) {
        return { name: 'ìµœê·¼ íŠ¸ë Œë“œ', recommendation: 'B', confidence: 100 - pPct, description: `ìµœê·¼ Banker ${recent.length - p}/${recent.length} (${(100 - pPct).toFixed(0)}%)` };
      }

      return { name: 'ìµœê·¼ íŠ¸ë Œë“œ', recommendation: 'B', confidence: 51, description: 'ê· í˜• ìƒíƒœ' };
    }

    // Import Modal
    function showImportModal() {
      document.getElementById('importModal').classList.remove('hidden');
      document.getElementById('importInput').focus();
    }

    function hideImportModal() {
      document.getElementById('importModal').classList.add('hidden');
      document.getElementById('importInput').value = '';
    }

    function importHistory() {
      const input = document.getElementById('importInput').value.toUpperCase().replace(/[^PBT]/g, '');
      if (!input) {
        alert('P, B, Të¡œ ì´ë£¨ì–´ì§„ ê¸°ë¡ì„ ì…ë ¥í•˜ì„¸ìš”');
        return;
      }
      history = input.split('');
      hideImportModal();
      saveAndUpdate();
    }
  </script>
</body>
</html>
